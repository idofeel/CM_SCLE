'use strict';const a82_0xa48d=['_nLengthUnit','4239fMdbti','uResID','_FileInfo','vMaterialMap','_arrayCleBuffer','TEXTURE_MAG_FILTER','TEXTURE_MIN_FILTER','fromCleVec3','failed\x20to\x20open\x20local\x20file:\x20','uBoundsRevision','_imageWidth','checkIfDefaultCameraValid','unbindSlice','TEXTURE_WRAP_S','REPEAT','loadFromArray','fAspect','bounds','current','_strModelName','cleScene','stuConfig','LINEAR','_stuSceneUnit','uPos','result','bindTexture','strFileName','readAsArrayBuffer','105HyIDOz','create','log','_arrObjAnimSaveData','206173EZczwj','updateDesc','_DefaultCamera','meet\x20a\x20unsupport\x20model\x20','bindSlice','fromCleCamera','SRGB8','stuMtlSaveDataMgr','TEXTURE_2D_ARRAY','stuCameraSaveDataMgr','RGBA8','cmonline','setViewParam','_arrCameraAnimSaveData','context','vMeshArray','textureColor','_vFocus','cleTextureWidth','materialView','viewport','TEXTURE_WRAP_T','_arrayByteBuffer','_uFrameSize','stuObjSaveDataMgr','vTextureMap','computeFocusOnBoxDesc','_nCleBufferlength','64BkOTEy','max','textureArray','_imageData','make','_uMtlID','_stuModelData','length','916741fXUnMH','desc','setEmpty','fromCleMaterial','_fZNear','_fZFar','vMaterialArray','stuAnimSaveDataMgr','arrResFile','getUpAxis','_arrSubsetMtlID','TEXTURE_2D','_arrObjSaveData','_uObjectID','3iQpaxf','cleTextureHeight','generateMipmap','byteLength','checkModelSupport','_imageHeight','_nFillMode','arrImageFile','setPerspective','fileName','texParameteri','fromCleMaterialIdx','865260DtcdLW','LINEAR_MIPMAP_LINEAR','NEAREST','115YyX45Lqs5Zyc5pmW5YaF6YOo5byA5Y+R5LiT55So','callback','1573088anVrTw','name','cleTexturePos','15351TgQwzy','from','_uModelID','bInverseY','CLAMP_TO_EDGE','update','673866ieBCwj','push','texture','pixelStorei'];(function(_0x3aeb08,_0x1b3315){const _0x5c9df5=a82_0x1cb6;while(!![]){try{const _0x204a48=parseInt(_0x5c9df5(0x1f2))+parseInt(_0x5c9df5(0x1d8))+-parseInt(_0x5c9df5(0x200))+-parseInt(_0x5c9df5(0x222))*parseInt(_0x5c9df5(0x205))+parseInt(_0x5c9df5(0x226))*-parseInt(_0x5c9df5(0x1e6))+parseInt(_0x5c9df5(0x1fa))*-parseInt(_0x5c9df5(0x1d0))+parseInt(_0x5c9df5(0x1f7));if(_0x204a48===_0x1b3315)break;else _0x3aeb08['push'](_0x3aeb08['shift']());}catch(_0x36adb5){_0x3aeb08['push'](_0x3aeb08['shift']());}}}(a82_0xa48d,0x9b109));import*as a82_0x2a3acd from'../Math/float3.js';import*as a82_0x284e18 from'../Math/box.js';import*as a82_0x4423ca from'../Camera/Camera.js';import*as a82_0x42356b from'./Comm.js';import*as a82_0x151e4e from'./Mesh.js';export function loadModelFromLocalFile(_0x5970fd,_0x5a1880,_0x2c7c28){const _0x1b65e4=a82_0x1cb6;let _0x3869d7={'fileName':_0x5970fd[_0x1b65e4(0x1f8)],'context':_0x5a1880,'callback':_0x2c7c28};var _0x52665d=new FileReader();{_0x52665d['onerror']=function(_0x3e46c3){onLocalFileError(_0x3869d7,_0x52665d,_0x3e46c3);},_0x52665d['onload']=function(_0x1fc323){onLocalFileLoaded(_0x3869d7,_0x52665d,_0x1fc323);};}return _0x52665d[_0x1b65e4(0x221)](_0x5970fd),_0x3869d7;}function onLocalFileError(_0x2dcd0d,_0x40d42a,_0x2ffede){const _0x58eebe=a82_0x1cb6;console[_0x58eebe(0x224)](_0x58eebe(0x20d)+_0x2dcd0d[_0x58eebe(0x1ef)]),_0x2dcd0d[_0x58eebe(0x1f6)](null);}function onLocalFileLoaded(_0x47aa81,_0x2e9f42,_0x3a51ad){const _0x5e4e3f=a82_0x1cb6;let _0x5805a3=_0x2e9f42[_0x5e4e3f(0x21e)];if(_0x5805a3[_0x5e4e3f(0x1e9)]<0xa){console[_0x5e4e3f(0x224)]('invalid\x20file\x20length\x20'+_0x5805a3['byteLength']+'\x20in\x20loacl\x20file\x20'+_0x47aa81[_0x5e4e3f(0x1ef)]),_0x47aa81[_0x5e4e3f(0x1f6)](null);return;}g_licData=_0x5e4e3f(0x1f5),InitModelStream();{g_p3dParser['_arrayByteBuffer']=_0x5805a3,g_p3dParser[_0x5e4e3f(0x209)]=new DataView(_0x5805a3,0x0,_0x5805a3['byteLength']),g_p3dParser[_0x5e4e3f(0x1cf)]=_0x5805a3[_0x5e4e3f(0x1e9)];}let _0x2bd46c=ParseCleStream();{g_p3dParser[_0x5e4e3f(0x209)]=null,g_p3dParser[_0x5e4e3f(0x23c)]=null;}if(_0x2bd46c!==!![]){console[_0x5e4e3f(0x224)]('failed\x20to\x20parse\x20data\x20in\x20local\x20file\x20'+_0x47aa81['fileName']),_0x47aa81[_0x5e4e3f(0x1f6)](null);return;}let _0x5a5e6b=fromCleScene(_0x47aa81[_0x5e4e3f(0x234)],g_sceneData);{_0x5a5e6b['localFileName']=_0x47aa81[_0x5e4e3f(0x1ef)];}_0x47aa81[_0x5e4e3f(0x1f6)](_0x5a5e6b);}function fromCleScene(_0x2bfcad,_0x759617){const _0x515f28=a82_0x1cb6;let _0x18cd1f={'cleScene':_0x759617,'eUpAxis':a82_0x42356b[_0x515f28(0x1e1)](_0x759617['stuConfig']),'bUpAxisNegative':a82_0x42356b['isUpAxisNegative'](_0x759617[_0x515f28(0x21a)]),'bCameraAnimation':_0x759617[_0x515f28(0x22f)][_0x515f28(0x233)][_0x515f28(0x1d7)]>0x0,'uFrameCount':_0x759617[_0x515f28(0x1df)][_0x515f28(0x23d)],'vTextureMap':{},'textureArray':null,'vMaterialArray':new Array(),'vMaterialMap':{},'materialView':null,'vMeshArray':new Array(),'bounds':a82_0x284e18[_0x515f28(0x1d4)](),'uWorldAlphaRevision':0x0,'uBoundsRevision':{'update':0x0,'current':0x0}};buildTextureMap(_0x2bfcad,_0x759617,_0x18cd1f),buildMaterialMap(_0x759617,_0x18cd1f),_0x18cd1f[_0x515f28(0x239)]=Material['makeView'](_0x2bfcad,_0x18cd1f[_0x515f28(0x1de)]);let _0x850717={};{for(const _0x43afbe of _0x759617['stuAnimSaveDataMgr'][_0x515f28(0x225)]){_0x850717[_0x43afbe[_0x515f28(0x1e5)]]=_0x43afbe;}}let _0x4bb614=_0x759617[_0x515f28(0x23e)];for(const _0x45604c of _0x759617['arrModelData']){const _0x5ef7b0=_0x45604c['_ModelInfo'];if(a82_0x42356b[_0x515f28(0x1ea)](_0x5ef7b0[_0x515f28(0x1d6)])){const _0x293628=a82_0x151e4e[_0x515f28(0x1fb)](_0x2bfcad,_0x5ef7b0,_0x4bb614,_0x850717,_0x18cd1f[_0x515f28(0x208)]);_0x18cd1f[_0x515f28(0x235)][_0x515f28(0x201)](_0x293628);}else console[_0x515f28(0x224)](_0x515f28(0x229)+_0x5ef7b0[_0x515f28(0x1fc)]+'\x20'+_0x5ef7b0[_0x515f28(0x218)]);}return updateBounds(_0x18cd1f),_0x18cd1f;}function a82_0x1cb6(_0x3520b3,_0x2a58ed){_0x3520b3=_0x3520b3-0x1cd;let _0xa48dfe=a82_0xa48d[_0x3520b3];return _0xa48dfe;}function buildTextureMap(_0x22aafa,_0x62c4ef,_0xd49871){const _0x7a6d7a=a82_0x1cb6;let _0x4f5ab6=0x1,_0x380f54=0x1,_0x493df7=new Array(),_0x2ddc3f={};_0x493df7[_0x7a6d7a(0x201)](Texture2D[_0x7a6d7a(0x223)](_0x22aafa,_0x22aafa[_0x7a6d7a(0x230)],_0x4f5ab6,_0x380f54,!![]));for(const _0x56c081 of _0x62c4ef[_0x7a6d7a(0x1ed)]){const _0x57692b=_0x56c081[_0x7a6d7a(0x207)][_0x7a6d7a(0x206)],_0xd4c2c2=_0x56c081['_FileInfo'][_0x7a6d7a(0x220)];for(const _0x3ec6e9 of _0x62c4ef[_0x7a6d7a(0x1e0)]){if(_0xd4c2c2==_0x3ec6e9['_name']){let _0x2bb02b=_0x2ddc3f[_0xd4c2c2];if(_0x2bb02b==null){_0x22aafa['pixelStorei'](_0x22aafa['UNPACK_ALIGNMENT'],0x1);{_0x2bb02b=Texture2D[_0x7a6d7a(0x214)](_0x22aafa,_0x22aafa[_0x7a6d7a(0x22c)],_0x3ec6e9[_0x7a6d7a(0x20f)],_0x3ec6e9['_imageHeight'],_0x3ec6e9[_0x7a6d7a(0x1d3)],![]);}_0x22aafa[_0x7a6d7a(0x203)](_0x22aafa['UNPACK_ALIGNMENT'],0x4),_0x2ddc3f[_0xd4c2c2]=_0x2bb02b,_0x4f5ab6=Math[_0x7a6d7a(0x1d1)](_0x3ec6e9[_0x7a6d7a(0x20f)],_0x4f5ab6),_0x380f54=Math['max'](_0x3ec6e9[_0x7a6d7a(0x1eb)],_0x380f54),_0x2bb02b['cmonline'][_0x7a6d7a(0x1f9)]=_0x493df7[_0x7a6d7a(0x1d7)],_0x2bb02b[_0x7a6d7a(0x231)][_0x7a6d7a(0x238)]=_0x3ec6e9[_0x7a6d7a(0x20f)],_0x2bb02b[_0x7a6d7a(0x231)][_0x7a6d7a(0x1e7)]=_0x3ec6e9['_imageHeight'],_0x493df7[_0x7a6d7a(0x201)](_0x2bb02b);}_0xd49871['vTextureMap'][_0x57692b]=_0x2bb02b[_0x7a6d7a(0x231)][_0x7a6d7a(0x1f9)];break;}}}_0xd49871[_0x7a6d7a(0x1d2)]=composeTextureMap(_0x22aafa,_0xd49871,_0x4f5ab6,_0x380f54,_0x493df7);}function composeTextureMap(_0x3ca23f,_0x12e8bf,_0x189875,_0x3fbfa6,_0x4287f2){const _0x37f4a1=a82_0x1cb6;if(_0x4287f2[_0x37f4a1(0x1d7)]==0x1)return _0x4287f2[0x0];let _0x1219af=RtTexture2DArray['create'](_0x3ca23f,_0x189875,_0x3fbfa6,_0x4287f2[_0x37f4a1(0x1d7)],_0x3ca23f[_0x37f4a1(0x230)],null),_0x3b1efd=Copy[_0x37f4a1(0x1d4)](_0x3ca23f);{_0x3b1efd[_0x37f4a1(0x1fd)]=!![],_0x3b1efd['fMipLevel']=0x0;}for(let _0x109edb=0x0;_0x109edb<_0x4287f2[_0x37f4a1(0x1d7)];++_0x109edb){RtTexture2DArray[_0x37f4a1(0x22a)](_0x1219af,_0x109edb);{let _0xc50096=_0x4287f2[_0x109edb];_0x3ca23f[_0x37f4a1(0x21f)](_0x3ca23f[_0x37f4a1(0x1e3)],_0xc50096);{_0xc50096[_0x37f4a1(0x231)]['cleTextureWidth']!=_0x189875||_0xc50096[_0x37f4a1(0x231)][_0x37f4a1(0x1e7)]!=_0x3fbfa6?(_0x3ca23f[_0x37f4a1(0x1f0)](_0x3ca23f[_0x37f4a1(0x1e3)],_0x3ca23f['TEXTURE_MIN_FILTER'],_0x3ca23f[_0x37f4a1(0x1f4)]),_0x3ca23f['texParameteri'](_0x3ca23f[_0x37f4a1(0x1e3)],_0x3ca23f[_0x37f4a1(0x20a)],_0x3ca23f[_0x37f4a1(0x21b)])):(_0x3ca23f[_0x37f4a1(0x1f0)](_0x3ca23f[_0x37f4a1(0x1e3)],_0x3ca23f[_0x37f4a1(0x20b)],_0x3ca23f[_0x37f4a1(0x1f4)]),_0x3ca23f[_0x37f4a1(0x1f0)](_0x3ca23f['TEXTURE_2D'],_0x3ca23f['TEXTURE_MAG_FILTER'],_0x3ca23f[_0x37f4a1(0x1f4)])),_0x3ca23f[_0x37f4a1(0x1f0)](_0x3ca23f[_0x37f4a1(0x1e3)],_0x3ca23f[_0x37f4a1(0x212)],_0x3ca23f[_0x37f4a1(0x1fe)]),_0x3ca23f['texParameteri'](_0x3ca23f[_0x37f4a1(0x1e3)],_0x3ca23f[_0x37f4a1(0x23b)],_0x3ca23f['CLAMP_TO_EDGE']);}_0x3ca23f[_0x37f4a1(0x21f)](_0x3ca23f[_0x37f4a1(0x1e3)],null),_0x3b1efd[_0x37f4a1(0x202)]=_0xc50096,_0x3b1efd['render'](_0x1219af[_0x37f4a1(0x23a)]);}RtTexture2DArray[_0x37f4a1(0x211)](_0x1219af,_0x109edb);}_0x3ca23f[_0x37f4a1(0x21f)](_0x3ca23f[_0x37f4a1(0x22e)],_0x1219af[_0x37f4a1(0x236)]);{_0x3ca23f[_0x37f4a1(0x1e8)](_0x3ca23f[_0x37f4a1(0x22e)]),_0x3ca23f[_0x37f4a1(0x1f0)](_0x3ca23f['TEXTURE_2D_ARRAY'],_0x3ca23f['TEXTURE_MIN_FILTER'],_0x3ca23f[_0x37f4a1(0x1f3)]),_0x3ca23f[_0x37f4a1(0x1f0)](_0x3ca23f['TEXTURE_2D_ARRAY'],_0x3ca23f['TEXTURE_MAG_FILTER'],_0x3ca23f['LINEAR']),_0x3ca23f['texParameteri'](_0x3ca23f['TEXTURE_2D_ARRAY'],_0x3ca23f['TEXTURE_WRAP_S'],_0x3ca23f[_0x37f4a1(0x213)]),_0x3ca23f['texParameteri'](_0x3ca23f['TEXTURE_2D_ARRAY'],_0x3ca23f[_0x37f4a1(0x23b)],_0x3ca23f['REPEAT']),_0x3ca23f[_0x37f4a1(0x1f0)](_0x3ca23f[_0x37f4a1(0x22e)],_0x3ca23f['TEXTURE_WRAP_R'],_0x3ca23f[_0x37f4a1(0x1fe)]);}return _0x3ca23f[_0x37f4a1(0x21f)](_0x3ca23f[_0x37f4a1(0x1e3)],null),_0x1219af[_0x37f4a1(0x236)];}function buildMaterialMap(_0x332d76,_0x179d9c){const _0x1aaf6c=a82_0x1cb6;for(const _0x20fd0f of _0x332d76[_0x1aaf6c(0x22d)]['_arrMtlSaveData']){const _0x58358f=Material[_0x1aaf6c(0x1db)](_0x20fd0f,_0x179d9c[_0x1aaf6c(0x1cd)]);{_0x58358f[_0x1aaf6c(0x21d)]=_0x179d9c[_0x1aaf6c(0x1de)][_0x1aaf6c(0x1d7)];}_0x179d9c['vMaterialArray'][_0x1aaf6c(0x201)](_0x58358f),_0x179d9c[_0x1aaf6c(0x208)][_0x20fd0f[_0x1aaf6c(0x1d5)]]=_0x58358f;}let _0x2a30c6=_0x332d76['stuObjSaveDataMgr'];for(const _0x5f4c7d of _0x2a30c6[_0x1aaf6c(0x1e4)]){if(_0x5f4c7d[_0x1aaf6c(0x1ec)]!=ADFFILL_SOLID)continue;for(const _0x590f1d of _0x5f4c7d[_0x1aaf6c(0x1e2)]){if(_0x179d9c['vMaterialMap'][_0x590f1d]!=null)continue;const _0x33567c=Material[_0x1aaf6c(0x1f1)](_0x590f1d);{_0x33567c[_0x1aaf6c(0x21d)]=_0x179d9c['vMaterialArray'][_0x1aaf6c(0x1d7)];}_0x179d9c[_0x1aaf6c(0x1de)][_0x1aaf6c(0x201)](_0x33567c),_0x179d9c['vMaterialMap'][_0x590f1d]=_0x33567c;}}}export function getBounds(_0x326f93){const _0x45fb4a=a82_0x1cb6;return _0x326f93[_0x45fb4a(0x20e)][_0x45fb4a(0x1ff)]!=_0x326f93[_0x45fb4a(0x20e)][_0x45fb4a(0x217)]&&(updateBounds(_0x326f93),_0x326f93[_0x45fb4a(0x20e)]['update']=_0x326f93['uBoundsRevision'][_0x45fb4a(0x217)]),_0x326f93[_0x45fb4a(0x216)];}export function updateBounds(_0x4b98eb){const _0x15bb35=a82_0x1cb6;a82_0x284e18[_0x15bb35(0x1da)](_0x4b98eb[_0x15bb35(0x216)]);for(const _0x45ac1d of _0x4b98eb['vMeshArray']){a82_0x151e4e['updateBounds'](_0x45ac1d,_0x4b98eb[_0x15bb35(0x216)]);}}export function computeDefaultCamera(_0x44d8b9,_0x1e5c43){const _0x4437c5=a82_0x1cb6,_0x33a112=_0x44d8b9[_0x4437c5(0x219)],_0x9ed339=_0x33a112['stuCameraSaveDataMgr'][_0x4437c5(0x228)],_0x4886a0=a82_0x42356b['unitToScaleFactor'](_0x33a112[_0x4437c5(0x21a)][_0x4437c5(0x21c)][_0x4437c5(0x204)]);if(a82_0x42356b[_0x4437c5(0x210)](_0x33a112))a82_0x4423ca[_0x4437c5(0x232)](_0x1e5c43,a82_0x42356b[_0x4437c5(0x20c)](null,_0x9ed339['_vEyePos']),a82_0x42356b[_0x4437c5(0x20c)](null,_0x9ed339[_0x4437c5(0x237)]),a82_0x42356b[_0x4437c5(0x20c)](null,_0x9ed339['_vUp'])),a82_0x4423ca[_0x4437c5(0x1ee)](_0x1e5c43,_0x9ed339['_fFOVY'],_0x1e5c43['desc'][_0x4437c5(0x215)],_0x9ed339[_0x4437c5(0x1dc)],_0x9ed339[_0x4437c5(0x1dd)]);else{a82_0x4423ca[_0x4437c5(0x232)](_0x1e5c43,a82_0x2a3acd[_0x4437c5(0x1fb)](_0x4886a0,_0x4886a0,_0x4886a0),a82_0x2a3acd[_0x4437c5(0x1fb)](0x0,0x0,0x0),a82_0x2a3acd['makeAxis'](_0x44d8b9['eUpAxis'])),a82_0x4423ca[_0x4437c5(0x1ee)](_0x1e5c43,0.85171175,_0x1e5c43[_0x4437c5(0x1d9)][_0x4437c5(0x215)],_0x4886a0*0.01,_0x4886a0*0x3e8);let _0x10a98e=a82_0x4423ca[_0x4437c5(0x1ce)](_0x1e5c43,_0x44d8b9[_0x4437c5(0x216)]);a82_0x4423ca[_0x4437c5(0x227)](_0x1e5c43,_0x10a98e);}}export function computeCameraDescAtFrame(_0x551ead,_0x17bc9f,_0x45fb5a){const _0x57d9d4=a82_0x1cb6;let _0x18b248=new ADF_CAMERA();return CalculateCameraDataByKeyFrame(_0x45fb5a,_0x17bc9f['cleScene']['stuCameraSaveDataMgr'][_0x57d9d4(0x233)],_0x18b248),a82_0x42356b[_0x57d9d4(0x22b)](_0x551ead,_0x18b248);}