'use strict';const a82_0x47df=['cleTextureHeight','_nLengthUnit','1309847dBlmsL','cleScene','texParameteri','TEXTURE_MIN_FILTER','fMipLevel','fromCleVec3','TEXTURE_2D_ARRAY','_vFocus','361eJfwtF','cmonline','6ZIFwHd','_imageHeight','cleTexturePos','cleTextureWidth','TEXTURE_WRAP_S','TEXTURE_WRAP_R','uPos','isUpAxisNegative','_fZNear','materialView','byteLength','_uModelID','stuCameraSaveDataMgr','setPerspective','bInverseY','_strModelName','stuConfig','_fFOVY','vMaterialArray','RGBA8','from','invalid\x20file\x20length\x20','_nCleBufferlength','_uFrameSize','LINEAR','_fZFar','CLAMP_TO_EDGE','failed\x20to\x20parse\x20data\x20in\x20local\x20file\x20','1743712PpyXnR','_uObjectID','create','arrImageFile','uResID','make','stuObjSaveDataMgr','failed\x20to\x20open\x20local\x20file:\x20','fromCleMaterialIdx','fileName','setViewParam','_arrayByteBuffer','_arrObjSaveData','_imageWidth','_arrMtlSaveData','fromCleMaterial','TEXTURE_WRAP_T','_arrSubsetMtlID','vTextureMap','vMeshArray','arrResFile','result','log','_vEyePos','bindSlice','_DefaultCamera','makeAxis','loadFromArray','viewport','strFileName','UNPACK_ALIGNMENT','textureArray','unitToScaleFactor','_vUp','push','_name','checkModelSupport','update','render','onerror','707478jPIouf','texture','unbindSlice','vMaterialMap','_arrayCleBuffer','_FileInfo','generateMipmap','115YyX45Lqs5Zyc5pmW5YaF6YOo5byA5Y+R5LiT55So','\x20in\x20loacl\x20file\x20','updateBounds','bounds','getUpAxis','textureColor','makeView','922871vaNuEr','NEAREST','desc','pixelStorei','setEmpty','_uMtlID','194423jzZuZA','max','uBoundsRevision','current','1lzsdbh','TEXTURE_2D','checkIfDefaultCameraValid','bindTexture','callback','TEXTURE_MAG_FILTER','eUpAxis','stuMtlSaveDataMgr','1570xLzmVK','arrModelData','241421UFxPDE','SRGB8','length','REPEAT','meet\x20a\x20unsupport\x20model\x20','onload'];function a82_0x4e83(_0x23ad5c,_0x374587){_0x23ad5c=_0x23ad5c-0x104;let _0x47dfa9=a82_0x47df[_0x23ad5c];return _0x47dfa9;}(function(_0x1678ec,_0x990946){const _0x4d667e=a82_0x4e83;while(!![]){try{const _0x3add24=-parseInt(_0x4d667e(0x115))*parseInt(_0x4d667e(0x119))+parseInt(_0x4d667e(0x151))+-parseInt(_0x4d667e(0x135))*parseInt(_0x4d667e(0x123))+parseInt(_0x4d667e(0x10f))+-parseInt(_0x4d667e(0x12b))+parseInt(_0x4d667e(0x179))+parseInt(_0x4d667e(0x121))*parseInt(_0x4d667e(0x133));if(_0x3add24===_0x990946)break;else _0x1678ec['push'](_0x1678ec['shift']());}catch(_0x526ccf){_0x1678ec['push'](_0x1678ec['shift']());}}}(a82_0x47df,0xf1383));import*as a82_0x43ce5c from'../Math/float3.js';import*as a82_0x22c3ee from'../Math/box.js';import*as a82_0x1e6bad from'../Camera/camera.js';import*as a82_0xbcc908 from'./Comm.js';import*as a82_0x11e975 from'./mesh.js';export function loadModelFromLocalFile(_0x5da137,_0x5d6325,_0x34846a){const _0x3de7fc=a82_0x4e83;let _0x5e2057={'fileName':_0x5da137['name'],'context':_0x5d6325,'callback':_0x34846a};var _0x35c9a4=new FileReader();{_0x35c9a4[_0x3de7fc(0x178)]=function(_0x4db884){onLocalFileError(_0x5e2057,_0x35c9a4,_0x4db884);},_0x35c9a4[_0x3de7fc(0x128)]=function(_0x5018c2){onLocalFileLoaded(_0x5e2057,_0x35c9a4,_0x5018c2);};}return _0x35c9a4['readAsArrayBuffer'](_0x5da137),_0x5e2057;}function onLocalFileError(_0x3ad235,_0x203569,_0x4a28f4){const _0x2cfb2b=a82_0x4e83;console[_0x2cfb2b(0x167)](_0x2cfb2b(0x158)+_0x3ad235[_0x2cfb2b(0x15a)]),_0x3ad235['callback'](null);}function onLocalFileLoaded(_0x32e499,_0x27b316,_0x12718c){const _0x404791=a82_0x4e83;let _0x236a15=_0x27b316[_0x404791(0x166)];if(_0x236a15[_0x404791(0x13f)]<0xa){console[_0x404791(0x167)](_0x404791(0x14a)+_0x236a15['byteLength']+_0x404791(0x109)+_0x32e499[_0x404791(0x15a)]),_0x32e499[_0x404791(0x11d)](null);return;}g_licData=_0x404791(0x108),InitModelStream();{g_p3dParser[_0x404791(0x15c)]=_0x236a15,g_p3dParser[_0x404791(0x105)]=new DataView(_0x236a15,0x0,_0x236a15['byteLength']),g_p3dParser[_0x404791(0x14b)]=_0x236a15['byteLength'];}let _0x5b3139=ParseCleStream();{g_p3dParser['_arrayCleBuffer']=null,g_p3dParser[_0x404791(0x15c)]=null;}if(_0x5b3139!==!![]){console['log'](_0x404791(0x150)+_0x32e499['fileName']),_0x32e499[_0x404791(0x11d)](null);return;}let _0x5240d0=fromCleScene(_0x32e499['context'],g_sceneData);{_0x5240d0['localFileName']=_0x32e499[_0x404791(0x15a)];}_0x32e499[_0x404791(0x11d)](_0x5240d0);}function fromCleScene(_0x10bc80,_0x46cc76){const _0x3ffd6b=a82_0x4e83;let _0x552a9c={'cleScene':_0x46cc76,'eUpAxis':a82_0xbcc908[_0x3ffd6b(0x10c)](_0x46cc76[_0x3ffd6b(0x145)]),'bUpAxisNegative':a82_0xbcc908[_0x3ffd6b(0x13c)](_0x46cc76[_0x3ffd6b(0x145)]),'bCameraAnimation':_0x46cc76['stuCameraSaveDataMgr']['_arrCameraAnimSaveData'][_0x3ffd6b(0x125)]>0x0,'uFrameCount':_0x46cc76['stuAnimSaveDataMgr'][_0x3ffd6b(0x14c)],'vTextureMap':{},'textureArray':null,'vMaterialArray':new Array(),'vMaterialMap':{},'materialView':null,'vMeshArray':new Array(),'bounds':a82_0x22c3ee['make'](),'uWorldAlphaRevision':0x0,'uBoundsRevision':{'update':0x0,'current':0x0}};buildTextureMap(_0x10bc80,_0x46cc76,_0x552a9c),buildMaterialMap(_0x46cc76,_0x552a9c),_0x552a9c[_0x3ffd6b(0x13e)]=Material[_0x3ffd6b(0x10e)](_0x10bc80,_0x552a9c[_0x3ffd6b(0x147)]);let _0x2c39f6={};{for(const _0x1b728a of _0x46cc76['stuAnimSaveDataMgr']['_arrObjAnimSaveData']){_0x2c39f6[_0x1b728a[_0x3ffd6b(0x152)]]=_0x1b728a;}}let _0xe96888=_0x46cc76['stuObjSaveDataMgr'];for(const _0x22ebab of _0x46cc76[_0x3ffd6b(0x122)]){const _0x31a6b9=_0x22ebab['_ModelInfo'];if(a82_0xbcc908[_0x3ffd6b(0x175)](_0x31a6b9['_stuModelData'])){const _0x470ce9=a82_0x11e975[_0x3ffd6b(0x149)](_0x10bc80,_0x31a6b9,_0xe96888,_0x2c39f6,_0x552a9c[_0x3ffd6b(0x104)]);_0x552a9c[_0x3ffd6b(0x164)]['push'](_0x470ce9);}else console[_0x3ffd6b(0x167)](_0x3ffd6b(0x127)+_0x31a6b9[_0x3ffd6b(0x140)]+'\x20'+_0x31a6b9[_0x3ffd6b(0x144)]);}return updateBounds(_0x552a9c),_0x552a9c;}function buildTextureMap(_0x5df695,_0x1be1ed,_0x8877c){const _0x195d34=a82_0x4e83;let _0x5b9722=0x1,_0x23b222=0x1,_0x308108=new Array(),_0x28d634={};_0x308108[_0x195d34(0x173)](Texture2D[_0x195d34(0x153)](_0x5df695,_0x5df695['RGBA8'],_0x5b9722,_0x23b222,!![]));for(const _0x199fc2 of _0x1be1ed[_0x195d34(0x154)]){const _0x8c9eb=_0x199fc2[_0x195d34(0x106)][_0x195d34(0x155)],_0x3bf8d2=_0x199fc2[_0x195d34(0x106)][_0x195d34(0x16e)];for(const _0x20edab of _0x1be1ed[_0x195d34(0x165)]){if(_0x3bf8d2==_0x20edab[_0x195d34(0x174)]){let _0x1b2d10=_0x28d634[_0x3bf8d2];if(_0x1b2d10==null){_0x5df695[_0x195d34(0x112)](_0x5df695[_0x195d34(0x16f)],0x1);{_0x1b2d10=Texture2D[_0x195d34(0x16c)](_0x5df695,_0x5df695[_0x195d34(0x124)],_0x20edab['_imageWidth'],_0x20edab[_0x195d34(0x136)],_0x20edab['_imageData'],![]);}_0x5df695['pixelStorei'](_0x5df695['UNPACK_ALIGNMENT'],0x4),_0x28d634[_0x3bf8d2]=_0x1b2d10,_0x5b9722=Math[_0x195d34(0x116)](_0x20edab[_0x195d34(0x15e)],_0x5b9722),_0x23b222=Math[_0x195d34(0x116)](_0x20edab[_0x195d34(0x136)],_0x23b222),_0x1b2d10[_0x195d34(0x134)][_0x195d34(0x137)]=_0x308108[_0x195d34(0x125)],_0x1b2d10[_0x195d34(0x134)][_0x195d34(0x138)]=_0x20edab[_0x195d34(0x15e)],_0x1b2d10[_0x195d34(0x134)][_0x195d34(0x129)]=_0x20edab[_0x195d34(0x136)],_0x308108['push'](_0x1b2d10);}_0x8877c[_0x195d34(0x163)][_0x8c9eb]=_0x1b2d10[_0x195d34(0x134)][_0x195d34(0x137)];break;}}}_0x8877c[_0x195d34(0x170)]=composeTextureMap(_0x5df695,_0x8877c,_0x5b9722,_0x23b222,_0x308108);}function composeTextureMap(_0x36b515,_0x5de31d,_0x2a2890,_0x322390,_0x4800aa){const _0x411c53=a82_0x4e83;if(_0x4800aa['length']==0x1)return _0x4800aa[0x0];let _0x2585a8=RtTexture2DArray[_0x411c53(0x153)](_0x36b515,_0x2a2890,_0x322390,_0x4800aa[_0x411c53(0x125)],_0x36b515[_0x411c53(0x148)],null),_0x4ac91e=Copy[_0x411c53(0x156)](_0x36b515);{_0x4ac91e[_0x411c53(0x143)]=!![],_0x4ac91e[_0x411c53(0x12f)]=0x0;}for(let _0x31ab00=0x0;_0x31ab00<_0x4800aa[_0x411c53(0x125)];++_0x31ab00){RtTexture2DArray[_0x411c53(0x169)](_0x2585a8,_0x31ab00);{let _0x3437bf=_0x4800aa[_0x31ab00];_0x36b515[_0x411c53(0x11c)](_0x36b515[_0x411c53(0x11a)],_0x3437bf);{_0x3437bf['cmonline'][_0x411c53(0x138)]!=_0x2a2890||_0x3437bf[_0x411c53(0x134)][_0x411c53(0x129)]!=_0x322390?(_0x36b515[_0x411c53(0x12d)](_0x36b515['TEXTURE_2D'],_0x36b515['TEXTURE_MIN_FILTER'],_0x36b515['NEAREST']),_0x36b515['texParameteri'](_0x36b515[_0x411c53(0x11a)],_0x36b515[_0x411c53(0x11e)],_0x36b515[_0x411c53(0x14d)])):(_0x36b515[_0x411c53(0x12d)](_0x36b515['TEXTURE_2D'],_0x36b515[_0x411c53(0x12e)],_0x36b515[_0x411c53(0x110)]),_0x36b515[_0x411c53(0x12d)](_0x36b515['TEXTURE_2D'],_0x36b515[_0x411c53(0x11e)],_0x36b515[_0x411c53(0x110)])),_0x36b515[_0x411c53(0x12d)](_0x36b515[_0x411c53(0x11a)],_0x36b515['TEXTURE_WRAP_S'],_0x36b515[_0x411c53(0x14f)]),_0x36b515['texParameteri'](_0x36b515['TEXTURE_2D'],_0x36b515[_0x411c53(0x161)],_0x36b515[_0x411c53(0x14f)]);}_0x36b515['bindTexture'](_0x36b515[_0x411c53(0x11a)],null),_0x4ac91e[_0x411c53(0x17a)]=_0x3437bf,_0x4ac91e[_0x411c53(0x177)](_0x2585a8[_0x411c53(0x16d)]);}RtTexture2DArray[_0x411c53(0x17b)](_0x2585a8,_0x31ab00);}_0x36b515[_0x411c53(0x11c)](_0x36b515[_0x411c53(0x131)],_0x2585a8['textureColor']);{_0x36b515[_0x411c53(0x107)](_0x36b515[_0x411c53(0x131)]),_0x36b515[_0x411c53(0x12d)](_0x36b515['TEXTURE_2D_ARRAY'],_0x36b515[_0x411c53(0x12e)],_0x36b515['LINEAR_MIPMAP_LINEAR']),_0x36b515[_0x411c53(0x12d)](_0x36b515['TEXTURE_2D_ARRAY'],_0x36b515['TEXTURE_MAG_FILTER'],_0x36b515[_0x411c53(0x14d)]),_0x36b515['texParameteri'](_0x36b515[_0x411c53(0x131)],_0x36b515[_0x411c53(0x139)],_0x36b515[_0x411c53(0x126)]),_0x36b515['texParameteri'](_0x36b515[_0x411c53(0x131)],_0x36b515[_0x411c53(0x161)],_0x36b515[_0x411c53(0x126)]),_0x36b515[_0x411c53(0x12d)](_0x36b515[_0x411c53(0x131)],_0x36b515[_0x411c53(0x13a)],_0x36b515[_0x411c53(0x14f)]);}return _0x36b515[_0x411c53(0x11c)](_0x36b515[_0x411c53(0x11a)],null),_0x2585a8[_0x411c53(0x10d)];}function buildMaterialMap(_0x40420d,_0x1aeeb4){const _0x37d7be=a82_0x4e83;for(const _0xa1c319 of _0x40420d[_0x37d7be(0x120)][_0x37d7be(0x15f)]){const _0x291623=Material[_0x37d7be(0x160)](_0xa1c319,_0x1aeeb4[_0x37d7be(0x163)]);{_0x291623[_0x37d7be(0x13b)]=_0x1aeeb4[_0x37d7be(0x147)][_0x37d7be(0x125)];}_0x1aeeb4[_0x37d7be(0x147)][_0x37d7be(0x173)](_0x291623),_0x1aeeb4[_0x37d7be(0x104)][_0xa1c319[_0x37d7be(0x114)]]=_0x291623;}let _0x340abf=_0x40420d[_0x37d7be(0x157)];for(const _0x3a7b2c of _0x340abf[_0x37d7be(0x15d)]){if(_0x3a7b2c['_nFillMode']!=ADFFILL_SOLID)continue;for(const _0x3a2d58 of _0x3a7b2c[_0x37d7be(0x162)]){if(_0x1aeeb4[_0x37d7be(0x104)][_0x3a2d58]!=null)continue;const _0x440de9=Material[_0x37d7be(0x159)](_0x3a2d58);{_0x440de9[_0x37d7be(0x13b)]=_0x1aeeb4[_0x37d7be(0x147)][_0x37d7be(0x125)];}_0x1aeeb4[_0x37d7be(0x147)][_0x37d7be(0x173)](_0x440de9),_0x1aeeb4['vMaterialMap'][_0x3a2d58]=_0x440de9;}}}export function getBounds(_0x276a7f){const _0x4986e1=a82_0x4e83;return _0x276a7f['uBoundsRevision'][_0x4986e1(0x176)]!=_0x276a7f[_0x4986e1(0x117)][_0x4986e1(0x118)]&&(updateBounds(_0x276a7f),_0x276a7f[_0x4986e1(0x117)][_0x4986e1(0x176)]=_0x276a7f[_0x4986e1(0x117)]['current']),_0x276a7f['bounds'];}export function updateBounds(_0x1d8762){const _0x560c51=a82_0x4e83;a82_0x22c3ee[_0x560c51(0x113)](_0x1d8762[_0x560c51(0x10b)]);for(const _0xce310d of _0x1d8762[_0x560c51(0x164)]){a82_0x11e975[_0x560c51(0x10a)](_0xce310d,_0x1d8762[_0x560c51(0x10b)]);}}export function computeDefaultCamera(_0xcd8f73,_0x36bc23){const _0x8433e0=a82_0x4e83,_0x3986c5=_0xcd8f73[_0x8433e0(0x12c)],_0x4795ed=_0x3986c5['stuCameraSaveDataMgr'][_0x8433e0(0x16a)],_0xa77037=a82_0xbcc908[_0x8433e0(0x171)](_0x3986c5[_0x8433e0(0x145)]['_stuSceneUnit'][_0x8433e0(0x12a)]);if(a82_0xbcc908[_0x8433e0(0x11b)](_0x3986c5))a82_0x1e6bad[_0x8433e0(0x15b)](_0x36bc23,a82_0xbcc908['fromCleVec3'](null,_0x4795ed[_0x8433e0(0x168)]),a82_0xbcc908[_0x8433e0(0x130)](null,_0x4795ed[_0x8433e0(0x132)]),a82_0xbcc908[_0x8433e0(0x130)](null,_0x4795ed[_0x8433e0(0x172)])),a82_0x1e6bad['setPerspective'](_0x36bc23,_0x4795ed[_0x8433e0(0x146)],_0x36bc23['desc']['fAspect'],_0x4795ed[_0x8433e0(0x13d)],_0x4795ed[_0x8433e0(0x14e)]);else{a82_0x1e6bad['setViewParam'](_0x36bc23,a82_0x43ce5c[_0x8433e0(0x149)](_0xa77037,_0xa77037,_0xa77037),a82_0x43ce5c['from'](0x0,0x0,0x0),a82_0x43ce5c[_0x8433e0(0x16b)](_0xcd8f73[_0x8433e0(0x11f)])),a82_0x1e6bad[_0x8433e0(0x142)](_0x36bc23,0.85171175,_0x36bc23[_0x8433e0(0x111)]['fAspect'],_0xa77037*0.01,_0xa77037*0x3e8);let _0x15fb9e=a82_0x1e6bad['computeFocusOnBoxDesc'](_0x36bc23,_0xcd8f73[_0x8433e0(0x10b)]);a82_0x1e6bad['updateDesc'](_0x36bc23,_0x15fb9e);}}export function computeCameraDescAtFrame(_0xbf7159,_0x12d560,_0x22344d){const _0x28a161=a82_0x4e83;let _0x164eb4=new ADF_CAMERA();return CalculateCameraDataByKeyFrame(_0x22344d,_0x12d560[_0x28a161(0x12c)][_0x28a161(0x141)]['_arrCameraAnimSaveData'],_0x164eb4),a82_0xbcc908['fromCleCamera'](_0xbf7159,_0x164eb4);}