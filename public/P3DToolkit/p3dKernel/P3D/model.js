'use strict';const a89_0x3df2=['_arrObjAnimSaveData','current','arrResFile','_imageWidth','_arrMtlSaveData','NEAREST','callback','cleScene','TEXTURE_2D','desc','RGBA8','stuObjSaveDataMgr','CLAMP_TO_EDGE','updateDesc','context','189497ZIefTP','strFileName','setViewParam','TEXTURE_MAG_FILTER','_stuSceneUnit','172818UcPuhN','setPerspective','fMipLevel','uBoundsRevision','_vUp','getUpAxis','bindSlice','render','6833RmAqUI','fromCleMaterialIdx','meet\x20a\x20unsupport\x20model\x20','115YyX45Lqs5Zyc5pmW5YaF6YOo5byA5Y+R5LiT55So','log','bindTexture','fileName','TEXTURE_MIN_FILTER','uResID','_stuModelData','vMaterialMap','invalid\x20file\x20length\x20','61jvjkLI','bounds','_fZNear','from','cmonline','checkIfDefaultCameraValid','texParameteri','byteLength','eUpAxis','cleTexturePos','_imageHeight','UNPACK_ALIGNMENT','pixelStorei','bInverseY','fAspect','length','274785NHJmuP','3359LpquEG','_fZFar','stuAnimSaveDataMgr','vMaterialArray','stuMtlSaveDataMgr','texture','TEXTURE_WRAP_T','unbindSlice','failed\x20to\x20open\x20local\x20file:\x20','localFileName','stuCameraSaveDataMgr','vTextureMap','onerror','arrImageFile','TEXTURE_2D_ARRAY','_arrayCleBuffer','max','isUpAxisNegative','REPEAT','1014046zsudzB','updateBounds','_nLengthUnit','LINEAR','LINEAR_MIPMAP_LINEAR','_FileInfo','makeAxis','materialView','textureArray','_vEyePos','_arrObjSaveData','create','fromCleVec3','17bfdXzW','unitToScaleFactor','checkModelSupport','_fFOVY','push','_imageData','update','_arrayByteBuffer','name','cleTextureWidth','23096mpXlFN','vMeshArray','textureColor','_uMtlID','TEXTURE_WRAP_S','SRGB8','make','_arrSubsetMtlID','_uModelID','_nFillMode','_arrCameraAnimSaveData','stuConfig','uPos','_vFocus','cleTextureHeight','loadFromArray'];(function(_0x444de0,_0x2171c5){const _0x37ada4=a89_0x599b;while(!![]){try{const _0x23e70e=-parseInt(_0x37ada4(0x104))+-parseInt(_0x37ada4(0xbc))+-parseInt(_0x37ada4(0xf4))*parseInt(_0x37ada4(0x105))+parseInt(_0x37ada4(0xb2))*parseInt(_0x37ada4(0xe8))+-parseInt(_0x37ada4(0xdb))+-parseInt(_0x37ada4(0xe0))+parseInt(_0x37ada4(0x118));if(_0x23e70e===_0x2171c5)break;else _0x444de0['push'](_0x444de0['shift']());}catch(_0x541209){_0x444de0['push'](_0x444de0['shift']());}}}(a89_0x3df2,0x40b98));import*as a89_0x1bd17f from'../Math/float3.js';import*as a89_0x5c11b8 from'../Math/box.js';import*as a89_0x5c5df0 from'../Camera/camera.js';import*as a89_0x5202d4 from'./comm.js';import*as a89_0x5d5201 from'./material.js';import*as a89_0xbab6f1 from'./mesh.js';function a89_0x599b(_0x2561ed,_0x260b1f){_0x2561ed=_0x2561ed-0xb2;let _0x3df243=a89_0x3df2[_0x2561ed];return _0x3df243;}export function loadModelFromLocalFile(_0x2e76a6,_0x3bed1d,_0x293ea6){const _0x417abf=a89_0x599b;let _0xc27ac4={'fileName':_0x2e76a6[_0x417abf(0xba)],'context':_0x3bed1d,'callback':_0x293ea6};var _0x35167d=new FileReader();{_0x35167d[_0x417abf(0x111)]=function(_0x5e994b){onLocalFileError(_0xc27ac4,_0x35167d,_0x5e994b);},_0x35167d['onload']=function(_0x2c22dc){onLocalFileLoaded(_0xc27ac4,_0x35167d,_0x2c22dc);};}return _0x35167d['readAsArrayBuffer'](_0x2e76a6),_0xc27ac4;}function onLocalFileError(_0x528608,_0x123c2b,_0x48c95a){const _0x4625ba=a89_0x599b;console[_0x4625ba(0xec)](_0x4625ba(0x10d)+_0x528608[_0x4625ba(0xee)]),_0x528608[_0x4625ba(0xd2)](null);}function onLocalFileLoaded(_0x4e03da,_0x2951d1,_0x3a01f2){const _0x42c545=a89_0x599b;let _0x5a32e9=_0x2951d1['result'];if(_0x5a32e9[_0x42c545(0xfb)]<0xa){console[_0x42c545(0xec)](_0x42c545(0xf3)+_0x5a32e9[_0x42c545(0xfb)]+'\x20in\x20loacl\x20file\x20'+_0x4e03da[_0x42c545(0xee)]),_0x4e03da[_0x42c545(0xd2)](null);return;}g_licData=_0x42c545(0xeb),InitModelStream();{g_p3dParser['_arrayByteBuffer']=_0x5a32e9,g_p3dParser[_0x42c545(0x114)]=new DataView(_0x5a32e9,0x0,_0x5a32e9[_0x42c545(0xfb)]),g_p3dParser['_nCleBufferlength']=_0x5a32e9['byteLength'];}let _0x318827=ParseCleStream();{g_p3dParser[_0x42c545(0x114)]=null,g_p3dParser[_0x42c545(0xb9)]=null;}if(_0x318827!==!![]){console[_0x42c545(0xec)]('failed\x20to\x20parse\x20data\x20in\x20local\x20file\x20'+_0x4e03da['fileName']),_0x4e03da[_0x42c545(0xd2)](null);return;}let _0x2b40a7=fromCleScene(_0x4e03da[_0x42c545(0xda)],g_sceneData);{_0x2b40a7[_0x42c545(0x10e)]=_0x4e03da[_0x42c545(0xee)];}_0x4e03da[_0x42c545(0xd2)](_0x2b40a7);}function fromCleScene(_0x315bb4,_0xc7918f){const _0xf0ed54=a89_0x599b;let _0x3b592e={'cleScene':_0xc7918f,'eUpAxis':a89_0x5202d4[_0xf0ed54(0xe5)](_0xc7918f[_0xf0ed54(0xc7)]),'bUpAxisNegative':a89_0x5202d4[_0xf0ed54(0x116)](_0xc7918f[_0xf0ed54(0xc7)]),'bCameraAnimation':_0xc7918f[_0xf0ed54(0x10f)][_0xf0ed54(0xc6)][_0xf0ed54(0x103)]>0x0,'uFrameCount':_0xc7918f[_0xf0ed54(0x107)]['_uFrameSize'],'vTextureMap':{},'textureArray':null,'vMaterialArray':new Array(),'vMaterialMap':{},'materialView':null,'vMeshArray':new Array(),'bounds':a89_0x5c11b8[_0xf0ed54(0xc2)](),'uWorldAlphaRevision':0x0,'uBoundsRevision':{'update':0x0,'current':0x0}};buildTextureMap(_0x315bb4,_0xc7918f,_0x3b592e),buildMaterialMap(_0xc7918f,_0x3b592e),_0x3b592e[_0xf0ed54(0x11f)]=a89_0x5d5201['makeView'](_0x315bb4,_0x3b592e[_0xf0ed54(0x108)]);let _0x3f3a03={};{for(const _0x4d9da2 of _0xc7918f[_0xf0ed54(0x107)][_0xf0ed54(0xcc)]){_0x3f3a03[_0x4d9da2['_uObjectID']]=_0x4d9da2;}}let _0x14004c=_0xc7918f[_0xf0ed54(0xd7)];for(const _0x4b154a of _0xc7918f['arrModelData']){const _0x50c1a2=_0x4b154a['_ModelInfo'];if(a89_0x5202d4[_0xf0ed54(0xb4)](_0x50c1a2[_0xf0ed54(0xf1)])){const _0x3a4ae0=a89_0xbab6f1[_0xf0ed54(0xf7)](_0x315bb4,_0x50c1a2,_0x14004c,_0x3f3a03,_0x3b592e['vMaterialMap']);_0x3b592e['vMeshArray'][_0xf0ed54(0xb6)](_0x3a4ae0);}else console[_0xf0ed54(0xec)](_0xf0ed54(0xea)+_0x50c1a2[_0xf0ed54(0xc4)]+'\x20'+_0x50c1a2['_strModelName']);}return updateBounds(_0x3b592e),_0x3b592e;}function buildTextureMap(_0x4378c6,_0x16e914,_0x4f60dd){const _0x3b2124=a89_0x599b;let _0x403eb2=0x1,_0x550991=0x1,_0x3ac90a=new Array(),_0x474460={};_0x3ac90a[_0x3b2124(0xb6)](Texture2D[_0x3b2124(0x123)](_0x4378c6,_0x4378c6['RGBA8'],_0x403eb2,_0x550991,!![]));for(const _0x5cbe57 of _0x16e914[_0x3b2124(0x112)]){const _0x4848d5=_0x5cbe57[_0x3b2124(0x11d)][_0x3b2124(0xf0)],_0x3c9846=_0x5cbe57[_0x3b2124(0x11d)][_0x3b2124(0xdc)];for(const _0x4ab28a of _0x16e914[_0x3b2124(0xce)]){if(_0x3c9846==_0x4ab28a['_name']){let _0xb1c27c=_0x474460[_0x3c9846];if(_0xb1c27c==null){_0x4378c6[_0x3b2124(0x100)](_0x4378c6[_0x3b2124(0xff)],0x1);{_0xb1c27c=Texture2D[_0x3b2124(0xcb)](_0x4378c6,_0x4378c6[_0x3b2124(0xc1)],_0x4ab28a[_0x3b2124(0xcf)],_0x4ab28a[_0x3b2124(0xfe)],_0x4ab28a[_0x3b2124(0xb7)],![]);}_0x4378c6[_0x3b2124(0x100)](_0x4378c6[_0x3b2124(0xff)],0x4),_0x474460[_0x3c9846]=_0xb1c27c,_0x403eb2=Math['max'](_0x4ab28a[_0x3b2124(0xcf)],_0x403eb2),_0x550991=Math[_0x3b2124(0x115)](_0x4ab28a['_imageHeight'],_0x550991),_0xb1c27c['cmonline']['cleTexturePos']=_0x3ac90a[_0x3b2124(0x103)],_0xb1c27c[_0x3b2124(0xf8)]['cleTextureWidth']=_0x4ab28a['_imageWidth'],_0xb1c27c['cmonline']['cleTextureHeight']=_0x4ab28a[_0x3b2124(0xfe)],_0x3ac90a[_0x3b2124(0xb6)](_0xb1c27c);}_0x4f60dd[_0x3b2124(0x110)][_0x4848d5]=_0xb1c27c[_0x3b2124(0xf8)][_0x3b2124(0xfd)];break;}}}_0x4f60dd[_0x3b2124(0x120)]=composeTextureMap(_0x4378c6,_0x4f60dd,_0x403eb2,_0x550991,_0x3ac90a);}function composeTextureMap(_0x5d6cc6,_0x21f6c1,_0x5b4750,_0x5bb7e0,_0x3051fe){const _0x5f28c4=a89_0x599b;if(_0x3051fe[_0x5f28c4(0x103)]==0x1)return _0x3051fe[0x0];let _0x285a57=RtTexture2DArray[_0x5f28c4(0x123)](_0x5d6cc6,_0x5b4750,_0x5bb7e0,_0x3051fe[_0x5f28c4(0x103)],_0x5d6cc6[_0x5f28c4(0xd6)],null),_0x55d6bd=Copy[_0x5f28c4(0xc2)](_0x5d6cc6);{_0x55d6bd[_0x5f28c4(0x101)]=!![],_0x55d6bd[_0x5f28c4(0xe2)]=0x0;}for(let _0x466fe7=0x0;_0x466fe7<_0x3051fe[_0x5f28c4(0x103)];++_0x466fe7){RtTexture2DArray[_0x5f28c4(0xe6)](_0x285a57,_0x466fe7);{let _0x38718d=_0x3051fe[_0x466fe7];_0x5d6cc6[_0x5f28c4(0xed)](_0x5d6cc6[_0x5f28c4(0xd4)],_0x38718d);{_0x38718d['cmonline'][_0x5f28c4(0xbb)]!=_0x5b4750||_0x38718d['cmonline'][_0x5f28c4(0xca)]!=_0x5bb7e0?(_0x5d6cc6['texParameteri'](_0x5d6cc6['TEXTURE_2D'],_0x5d6cc6[_0x5f28c4(0xef)],_0x5d6cc6[_0x5f28c4(0xd1)]),_0x5d6cc6['texParameteri'](_0x5d6cc6['TEXTURE_2D'],_0x5d6cc6[_0x5f28c4(0xde)],_0x5d6cc6[_0x5f28c4(0x11b)])):(_0x5d6cc6[_0x5f28c4(0xfa)](_0x5d6cc6[_0x5f28c4(0xd4)],_0x5d6cc6[_0x5f28c4(0xef)],_0x5d6cc6[_0x5f28c4(0xd1)]),_0x5d6cc6[_0x5f28c4(0xfa)](_0x5d6cc6[_0x5f28c4(0xd4)],_0x5d6cc6[_0x5f28c4(0xde)],_0x5d6cc6['NEAREST'])),_0x5d6cc6[_0x5f28c4(0xfa)](_0x5d6cc6['TEXTURE_2D'],_0x5d6cc6['TEXTURE_WRAP_S'],_0x5d6cc6[_0x5f28c4(0xd8)]),_0x5d6cc6[_0x5f28c4(0xfa)](_0x5d6cc6['TEXTURE_2D'],_0x5d6cc6[_0x5f28c4(0x10b)],_0x5d6cc6[_0x5f28c4(0xd8)]);}_0x5d6cc6[_0x5f28c4(0xed)](_0x5d6cc6[_0x5f28c4(0xd4)],null),_0x55d6bd[_0x5f28c4(0x10a)]=_0x38718d,_0x55d6bd[_0x5f28c4(0xe7)](_0x285a57['viewport']);}RtTexture2DArray[_0x5f28c4(0x10c)](_0x285a57,_0x466fe7);}_0x5d6cc6[_0x5f28c4(0xed)](_0x5d6cc6[_0x5f28c4(0x113)],_0x285a57[_0x5f28c4(0xbe)]);{_0x5d6cc6['generateMipmap'](_0x5d6cc6[_0x5f28c4(0x113)]),_0x5d6cc6[_0x5f28c4(0xfa)](_0x5d6cc6[_0x5f28c4(0x113)],_0x5d6cc6[_0x5f28c4(0xef)],_0x5d6cc6[_0x5f28c4(0x11c)]),_0x5d6cc6['texParameteri'](_0x5d6cc6[_0x5f28c4(0x113)],_0x5d6cc6['TEXTURE_MAG_FILTER'],_0x5d6cc6[_0x5f28c4(0x11b)]),_0x5d6cc6[_0x5f28c4(0xfa)](_0x5d6cc6[_0x5f28c4(0x113)],_0x5d6cc6[_0x5f28c4(0xc0)],_0x5d6cc6['REPEAT']),_0x5d6cc6[_0x5f28c4(0xfa)](_0x5d6cc6[_0x5f28c4(0x113)],_0x5d6cc6[_0x5f28c4(0x10b)],_0x5d6cc6[_0x5f28c4(0x117)]),_0x5d6cc6['texParameteri'](_0x5d6cc6[_0x5f28c4(0x113)],_0x5d6cc6['TEXTURE_WRAP_R'],_0x5d6cc6[_0x5f28c4(0xd8)]);}return _0x5d6cc6[_0x5f28c4(0xed)](_0x5d6cc6[_0x5f28c4(0xd4)],null),_0x285a57[_0x5f28c4(0xbe)];}function buildMaterialMap(_0x300235,_0x4a44f7){const _0x10770c=a89_0x599b;for(const _0x16c5a8 of _0x300235[_0x10770c(0x109)][_0x10770c(0xd0)]){const _0x462f81=a89_0x5d5201['fromCleMaterial'](_0x16c5a8,_0x4a44f7[_0x10770c(0x110)]);{_0x462f81[_0x10770c(0xc8)]=_0x4a44f7[_0x10770c(0x108)][_0x10770c(0x103)];}_0x4a44f7[_0x10770c(0x108)][_0x10770c(0xb6)](_0x462f81),_0x4a44f7[_0x10770c(0xf2)][_0x16c5a8[_0x10770c(0xbf)]]=_0x462f81;}let _0x48c317=_0x300235[_0x10770c(0xd7)];for(const _0x12c078 of _0x48c317[_0x10770c(0x122)]){if(_0x12c078[_0x10770c(0xc5)]!=ADFFILL_SOLID)continue;for(const _0x47e340 of _0x12c078[_0x10770c(0xc3)]){if(_0x4a44f7[_0x10770c(0xf2)][_0x47e340]!=null)continue;const _0x2d3a02=a89_0x5d5201[_0x10770c(0xe9)](_0x47e340);{_0x2d3a02[_0x10770c(0xc8)]=_0x4a44f7[_0x10770c(0x108)][_0x10770c(0x103)];}_0x4a44f7[_0x10770c(0x108)]['push'](_0x2d3a02),_0x4a44f7[_0x10770c(0xf2)][_0x47e340]=_0x2d3a02;}}}export function getBounds(_0x44c63d){const _0x43e0b1=a89_0x599b;return _0x44c63d[_0x43e0b1(0xe3)][_0x43e0b1(0xb8)]!=_0x44c63d[_0x43e0b1(0xe3)]['current']&&(updateBounds(_0x44c63d),_0x44c63d[_0x43e0b1(0xe3)][_0x43e0b1(0xb8)]=_0x44c63d[_0x43e0b1(0xe3)][_0x43e0b1(0xcd)]),_0x44c63d[_0x43e0b1(0xf5)];}export function updateBounds(_0x6595c5){const _0x1aa1e4=a89_0x599b;a89_0x5c11b8['setEmpty'](_0x6595c5['bounds']);for(const _0x2f0cb3 of _0x6595c5[_0x1aa1e4(0xbd)]){a89_0xbab6f1[_0x1aa1e4(0x119)](_0x2f0cb3,_0x6595c5[_0x1aa1e4(0xf5)]);}}export function computeDefaultCamera(_0xc9661c,_0x544455){const _0x2b8e3b=a89_0x599b,_0x1c9c6f=_0xc9661c['cleScene'],_0x50aa59=_0x1c9c6f[_0x2b8e3b(0x10f)]['_DefaultCamera'],_0x3f3520=a89_0x5202d4[_0x2b8e3b(0xb3)](_0x1c9c6f[_0x2b8e3b(0xc7)][_0x2b8e3b(0xdf)][_0x2b8e3b(0x11a)]);if(a89_0x5202d4[_0x2b8e3b(0xf9)](_0x1c9c6f))a89_0x5c5df0[_0x2b8e3b(0xdd)](_0x544455,a89_0x5202d4[_0x2b8e3b(0x124)](null,_0x50aa59[_0x2b8e3b(0x121)]),a89_0x5202d4['fromCleVec3'](null,_0x50aa59[_0x2b8e3b(0xc9)]),a89_0x5202d4[_0x2b8e3b(0x124)](null,_0x50aa59[_0x2b8e3b(0xe4)])),a89_0x5c5df0['setPerspective'](_0x544455,_0x50aa59[_0x2b8e3b(0xb5)],_0x544455[_0x2b8e3b(0xd5)][_0x2b8e3b(0x102)],_0x50aa59[_0x2b8e3b(0xf6)],_0x50aa59[_0x2b8e3b(0x106)]);else{a89_0x5c5df0[_0x2b8e3b(0xdd)](_0x544455,a89_0x1bd17f[_0x2b8e3b(0xf7)](_0x3f3520,_0x3f3520,_0x3f3520),a89_0x1bd17f[_0x2b8e3b(0xf7)](0x0,0x0,0x0),a89_0x1bd17f[_0x2b8e3b(0x11e)](_0xc9661c[_0x2b8e3b(0xfc)])),a89_0x5c5df0[_0x2b8e3b(0xe1)](_0x544455,0.85171175,_0x544455['desc'][_0x2b8e3b(0x102)],_0x3f3520*0.01,_0x3f3520*0x3e8);let _0x31d97a=a89_0x5c5df0['computeFocusOnBoxDesc'](_0x544455,_0xc9661c[_0x2b8e3b(0xf5)]);a89_0x5c5df0[_0x2b8e3b(0xd9)](_0x544455,_0x31d97a);}}export function computeCameraDescAtFrame(_0x26f96f,_0xe706a9,_0x48f476){const _0x477f44=a89_0x599b;let _0x3edc69=new ADF_CAMERA();return CalculateCameraDataByKeyFrame(_0x48f476,_0xe706a9[_0x477f44(0xd3)][_0x477f44(0x10f)]['_arrCameraAnimSaveData'],_0x3edc69),a89_0x5202d4['fromCleCamera'](_0x26f96f,_0x3edc69);}