'use strict';const a88_0x1170=['_matWorld','_arrIndexData','vWorldITMatrixArray','cleObjectArray','_uIsUV','fromCleBox','createStaticIndexBuffer','solidView','uploadArrayData','1137534tRYTMU','1079949NwOPWE','1113000QGFRWF','xyz<n','_arrKeyFrameData','1222788bcSBmo','uObjCount','cleModel','bContainUV','fill','LogicError','vSubsetBuffer','textureWorld','transform','length','uWorldAlphaRevision','textureAlpha','_uModelID','mul','cleObjAnimationArray','alpha','_uIndexCount','textureWorldIT','fromCleMatrix','createForFloatArray','vAlphaArray','vBuffer','xyz<n<uv','1369307mErsft','toTextureFloatArray','createStaticVertexBuffer','_arrSubsetMtlID','make','754824iABWfN','vFlagArray','push','uIndex','vWorldMatrixArray','_uMeshID','view','invalid\x20material\x20index\x20','1488995pGRaPH','_nFillMode','iBuffer','_matLocal','_box','getArrayData','_uStartIndex','_arrTranspKeyFrm','transparentView','_arrSubset','textureMaterialPos','inverseTranspose','uPos','_arrVertexData','_stuModelData'];(function(_0xf73483,_0xedc4c6){const _0x1e9ba6=a88_0x496b;while(!![]){try{const _0x307625=parseInt(_0x1e9ba6(0xdf))+parseInt(_0x1e9ba6(0xe4))+-parseInt(_0x1e9ba6(0xc3))+parseInt(_0x1e9ba6(0xc8))+parseInt(_0x1e9ba6(0xc5))+-parseInt(_0x1e9ba6(0xec))+-parseInt(_0x1e9ba6(0xc4));if(_0x307625===_0xedc4c6)break;else _0xf73483['push'](_0xf73483['shift']());}catch(_0x1d912a){_0xf73483['push'](_0xf73483['shift']());}}}(a88_0x1170,0xb7f21));import*as a88_0x4c4d85 from'../Math/math.js';import*as a88_0x22fa57 from'../Math/matrix.js';import*as a88_0x146f04 from'../Math/box.js';import*as a88_0x410878 from'./comm.js';export function from(_0x3efa43,_0x5aad43,_0x207d40,_0x162361,_0x5048a3){const _0xbe18d5=a88_0x496b;let _0x15f62e={'uIndex':_0x5aad43[_0xbe18d5(0xd4)],'cleModel':_0x5aad43,'bounds':a88_0x410878[_0xbe18d5(0xbf)](null,_0x5aad43[_0xbe18d5(0xfa)][_0xbe18d5(0xf0)]),'bContainUV':![],'cleObjectArray':new Array(),'cleObjAnimationArray':new Array(),'vFlagArray':new Array(),'vWorldMatrixArray':null,'vWorldITMatrixArray':null,'vAlphaArray':null,'vBuffer':null,'vSubsetBuffer':null,'iBuffer':null,'view':null,'solidView':null,'transparentView':null,'uWorldAlphaRevision':0x0},_0x11a823=_0x5aad43[_0xbe18d5(0xfa)];_0x15f62e[_0xbe18d5(0xcb)]=_0x11a823['_uIsUV']===0x1,_0x15f62e[_0xbe18d5(0xdd)]=Buffer[_0xbe18d5(0xe1)](_0x3efa43,_0x11a823[_0xbe18d5(0xf9)],_0x15f62e['bContainUV']?_0xbe18d5(0xde):_0xbe18d5(0xc6)),_0x15f62e[_0xbe18d5(0xce)]=buildVertexSubsetIndex(_0x3efa43,_0x5aad43),_0x15f62e[_0xbe18d5(0xee)]=Buffer[_0xbe18d5(0xc0)](_0x3efa43,_0x11a823[_0xbe18d5(0xfc)]);const _0x2c3924=_0x15f62e[_0xbe18d5(0xe7)];for(const _0x45e04e of _0x207d40['_arrObjSaveData']){if(_0x45e04e[_0xbe18d5(0xed)]!=ADFFILL_SOLID)continue;if(_0x45e04e[_0xbe18d5(0xe9)]==_0x2c3924){let _0x14b7c3=computeSubsetFlag(_0x5aad43,_0x45e04e,_0x5048a3);_0x15f62e[_0xbe18d5(0xbd)][_0xbe18d5(0xe6)](_0x45e04e),_0x15f62e[_0xbe18d5(0xd6)][_0xbe18d5(0xe6)](_0x162361[_0x45e04e['_uObjectID']]),_0x15f62e[_0xbe18d5(0xe5)][_0xbe18d5(0xe6)](_0x14b7c3);}}return _0x15f62e[_0xbe18d5(0xe8)]=new Array(_0x15f62e[_0xbe18d5(0xbd)]['length']),_0x15f62e[_0xbe18d5(0xbc)]=new Array(_0x15f62e[_0xbe18d5(0xbd)][_0xbe18d5(0xd1)]),_0x15f62e[_0xbe18d5(0xdc)]=new Array(_0x15f62e[_0xbe18d5(0xbd)][_0xbe18d5(0xd1)])[_0xbe18d5(0xcc)](0x1),_0x15f62e['view']=makeView(_0x3efa43,_0x15f62e[_0xbe18d5(0xbd)][_0xbe18d5(0xd1)],_0x5aad43[_0xbe18d5(0xfa)][_0xbe18d5(0xf5)][_0xbe18d5(0xd1)]),_0x15f62e[_0xbe18d5(0xc1)]=makeObjectView(_0x3efa43,_0x15f62e['cleObjectArray']['length']),_0x15f62e[_0xbe18d5(0xf4)]=makeObjectView(_0x3efa43,_0x15f62e[_0xbe18d5(0xbd)][_0xbe18d5(0xd1)]),initWorldMatrixAndAlpha(_0x15f62e),updateObjSubsetView(_0x15f62e,_0x5048a3),_0x15f62e;}function buildVertexSubsetIndex(_0x7e18b2,_0x685afb){const _0x399b1d=a88_0x496b;let _0x3d0f27=_0x685afb['_stuModelData'],_0xac374b=new Array(_0x3d0f27[_0x399b1d(0xf9)][_0x399b1d(0xd1)]/(_0x3d0f27[_0x399b1d(0xbe)]===0x1?0x8:0x6));if(_0x685afb[_0x399b1d(0xfa)][_0x399b1d(0xf5)][_0x399b1d(0xd1)]>0x1)for(let _0x15cd8f=0x0;_0x15cd8f<_0x685afb[_0x399b1d(0xfa)][_0x399b1d(0xf5)]['length'];++_0x15cd8f){let _0xf872e2=_0x685afb[_0x399b1d(0xfa)][_0x399b1d(0xf5)][_0x15cd8f][_0x399b1d(0xf2)],_0x3f9992=_0x685afb[_0x399b1d(0xfa)][_0x399b1d(0xf5)][_0x15cd8f][_0x399b1d(0xd8)];for(let _0x1f93fc=0x0;_0x1f93fc<_0x3f9992;++_0x1f93fc){let _0x50c705=_0xf872e2+_0x1f93fc,_0x402594=_0x3d0f27[_0x399b1d(0xfc)][_0x50c705];_0xac374b[_0x402594]=_0x15cd8f;}}else _0xac374b[_0x399b1d(0xcc)](0x0);return Buffer[_0x399b1d(0xe1)](_0x7e18b2,new Float32Array(_0xac374b),'i1');}function computeSubsetFlag(_0x3a28f2,_0x12431f,_0x44883c){const _0x14e8bb=a88_0x496b;let _0x420eb7=0x0;if(_0x3a28f2[_0x14e8bb(0xfa)][_0x14e8bb(0xf5)][_0x14e8bb(0xd1)]>0x1&&_0x3a28f2[_0x14e8bb(0xfa)][_0x14e8bb(0xf5)][_0x14e8bb(0xd1)]==_0x12431f[_0x14e8bb(0xe2)][_0x14e8bb(0xd1)]){let _0x1d50d9=0x0,_0x22d333=0x0;for(let _0x49ff8c=0x0;_0x49ff8c<_0x12431f[_0x14e8bb(0xe2)][_0x14e8bb(0xd1)];++_0x49ff8c){let _0x31d165=_0x12431f[_0x14e8bb(0xe2)][_0x49ff8c],_0x4086c7=_0x44883c[_0x31d165];if(_0x4086c7==null)throw new error[(_0x14e8bb(0xcd))](_0x14e8bb(0xeb)+_0x31d165);_0x4086c7[_0x14e8bb(0xd7)]<0x1?_0x22d333++:_0x1d50d9++;}if(_0x1d50d9==_0x12431f[_0x14e8bb(0xe2)]['length'])_0x420eb7=-0x1;else _0x22d333==_0x12431f[_0x14e8bb(0xe2)][_0x14e8bb(0xd1)]&&(_0x420eb7=0x1);}else{let _0x3a7be7=0x0;_0x12431f[_0x14e8bb(0xe2)][_0x14e8bb(0xd1)]>0x0&&(_0x3a7be7=_0x12431f[_0x14e8bb(0xe2)][0x0]);let _0x48f3d8=_0x44883c[_0x3a7be7];if(_0x48f3d8==null)throw new error['LogicError']('invalid\x20material\x20index\x20'+_0x3a7be7);_0x420eb7=_0x48f3d8[_0x14e8bb(0xd7)]<0x1?0x1:-0x1;}return _0x420eb7;}function a88_0x496b(_0x242cf8,_0x22b0e6){_0x242cf8=_0x242cf8-0xbc;let _0x1170b9=a88_0x1170[_0x242cf8];return _0x1170b9;}export function initWorldMatrixAndAlpha(_0x24a1b3){const _0x674702=a88_0x496b;resetMeshObjectView(_0x24a1b3);let _0x49efd8=new ADF_BASEMATRIX(),_0x1496a8=Texture2D[_0x674702(0xf1)](_0x24a1b3['view'][_0x674702(0xcf)]),_0xd97599=Texture2D['getArrayData'](_0x24a1b3[_0x674702(0xea)][_0x674702(0xd9)]),_0x51b399=Texture2D[_0x674702(0xf1)](_0x24a1b3[_0x674702(0xea)][_0x674702(0xd3)]);for(let _0x38d48e=0x0;_0x38d48e<_0x24a1b3['cleObjectArray'][_0x674702(0xd1)];++_0x38d48e){let _0x16049a=_0x24a1b3[_0x674702(0xbd)][_0x38d48e],_0x44bcc2=_0x24a1b3[_0x674702(0xd6)][_0x38d48e];if(_0x44bcc2!=null&&_0x44bcc2['_arrKeyFrameData'][_0x674702(0xd1)]>0x0)CalculateObjectWldMatrix(0x0,_0x44bcc2,_0x16049a[_0x674702(0xef)],_0x16049a[_0x674702(0xfb)],_0x49efd8),_0x24a1b3[_0x674702(0xe8)][_0x38d48e]=a88_0x410878[_0x674702(0xda)](_0x24a1b3[_0x674702(0xe8)][_0x38d48e],_0x49efd8),_0x24a1b3[_0x674702(0xbc)][_0x38d48e]=a88_0x22fa57[_0x674702(0xf7)](_0x24a1b3[_0x674702(0xbc)][_0x38d48e],_0x24a1b3[_0x674702(0xe8)][_0x38d48e]);else{let _0x5f57f4=a88_0x410878[_0x674702(0xda)](null,_0x16049a[_0x674702(0xef)]),_0x5083a4=a88_0x410878[_0x674702(0xda)](null,_0x16049a[_0x674702(0xfb)]);_0x24a1b3['vWorldMatrixArray'][_0x38d48e]=a88_0x22fa57[_0x674702(0xd5)](_0x24a1b3[_0x674702(0xe8)][_0x38d48e],_0x5f57f4,_0x5083a4),_0x24a1b3[_0x674702(0xbc)][_0x38d48e]=a88_0x22fa57[_0x674702(0xf7)](_0x24a1b3[_0x674702(0xbc)][_0x38d48e],_0x24a1b3[_0x674702(0xe8)][_0x38d48e]);}_0x44bcc2!=null&&_0x44bcc2[_0x674702(0xf3)][_0x674702(0xd1)]>0x0&&(_0x24a1b3[_0x674702(0xdc)][_0x38d48e]=CalculateObjectNoTransparency(0x0,_0x44bcc2)),a88_0x22fa57[_0x674702(0xe0)](_0x24a1b3['vWorldMatrixArray'][_0x38d48e],_0x1496a8,_0x38d48e*0xc),a88_0x22fa57[_0x674702(0xe0)](_0x24a1b3['vWorldITMatrixArray'][_0x38d48e],_0xd97599,_0x38d48e*0xc),_0x51b399[_0x38d48e]=_0x24a1b3['vAlphaArray'][_0x38d48e],populateMeshObjectView(_0x24a1b3,_0x38d48e);}Texture2D[_0x674702(0xc2)](_0x24a1b3[_0x674702(0xea)][_0x674702(0xcf)]),Texture2D['uploadArrayData'](_0x24a1b3[_0x674702(0xea)]['textureWorldIT']),Texture2D[_0x674702(0xc2)](_0x24a1b3[_0x674702(0xea)]['textureAlpha']),uploadMeshObjectView(_0x24a1b3);}export function updateWorldMatrixAndAlpha(_0x276595,_0x732a66,_0x1a5fb0){const _0x5697f8=a88_0x496b;if(_0x276595[_0x5697f8(0xd2)]!=_0x1a5fb0){resetMeshObjectView(_0x276595);let _0xc12b73=new ADF_BASEMATRIX(),_0x301c1d=Texture2D[_0x5697f8(0xf1)](_0x276595[_0x5697f8(0xea)]['textureWorld']),_0x5720fc=Texture2D[_0x5697f8(0xf1)](_0x276595[_0x5697f8(0xea)]['textureWorldIT']),_0x4af6fc=Texture2D['getArrayData'](_0x276595[_0x5697f8(0xea)][_0x5697f8(0xd3)]),_0x2707be=![],_0x5043ef=![];for(let _0x37aec3=0x0;_0x37aec3<_0x276595[_0x5697f8(0xbd)][_0x5697f8(0xd1)];++_0x37aec3){let _0x3a4bfa=_0x276595['cleObjectArray'][_0x37aec3],_0x474436=_0x276595[_0x5697f8(0xd6)][_0x37aec3];_0x474436!=null&&(_0x474436[_0x5697f8(0xc7)][_0x5697f8(0xd1)]>0x0&&(CalculateObjectWldMatrix(_0x732a66,_0x474436,_0x3a4bfa[_0x5697f8(0xef)],_0x3a4bfa['_matWorld'],_0xc12b73),_0x276595[_0x5697f8(0xe8)][_0x37aec3]=a88_0x410878[_0x5697f8(0xda)](_0x276595[_0x5697f8(0xe8)][_0x37aec3],_0xc12b73),_0x276595[_0x5697f8(0xbc)][_0x37aec3]=a88_0x22fa57[_0x5697f8(0xf7)](_0x276595[_0x5697f8(0xbc)][_0x37aec3],_0x276595[_0x5697f8(0xe8)][_0x37aec3]),a88_0x22fa57['toTextureFloatArray'](_0x276595['vWorldMatrixArray'][_0x37aec3],_0x301c1d,_0x37aec3*0xc),a88_0x22fa57[_0x5697f8(0xe0)](_0x276595[_0x5697f8(0xbc)][_0x37aec3],_0x5720fc,_0x37aec3*0xc),_0x2707be=!![]),_0x474436['_arrTranspKeyFrm'][_0x5697f8(0xd1)]>0x0&&(_0x276595[_0x5697f8(0xdc)][_0x37aec3]=CalculateObjectNoTransparency(_0x732a66,_0x474436),_0x4af6fc[_0x37aec3]=_0x276595[_0x5697f8(0xdc)][_0x37aec3],_0x5043ef=!![])),populateMeshObjectView(_0x276595,_0x37aec3);}_0x2707be&&(Texture2D['uploadArrayData'](_0x276595[_0x5697f8(0xea)][_0x5697f8(0xcf)]),Texture2D[_0x5697f8(0xc2)](_0x276595[_0x5697f8(0xea)]['textureWorldIT'])),_0x5043ef&&(Texture2D[_0x5697f8(0xc2)](_0x276595[_0x5697f8(0xea)][_0x5697f8(0xd3)]),uploadMeshObjectView(_0x276595)),_0x276595[_0x5697f8(0xd2)]=_0x1a5fb0;}}export function updateBounds(_0x3f2f86,_0x196b45){const _0x3bc915=a88_0x496b;let _0x3128d4=a88_0x146f04[_0x3bc915(0xe3)]();for(const _0x551069 of _0x3f2f86[_0x3bc915(0xe8)]){_0x3128d4=a88_0x146f04[_0x3bc915(0xd0)](_0x3128d4,_0x3f2f86['bounds'],_0x551069),_0x196b45=a88_0x146f04['merge'](_0x196b45,_0x196b45,_0x3128d4);}}function makeView(_0x5de65a,_0x2b0d9b,_0x33cd53){const _0xddd646=a88_0x496b;let _0x358db3={'textureWorld':Texture2D['createForFloatArray'](_0x5de65a,0x4,_0x2b0d9b*0x3),'textureWorldIT':Texture2D[_0xddd646(0xdb)](_0x5de65a,0x4,_0x2b0d9b*0x3),'textureAlpha':Texture2D[_0xddd646(0xdb)](_0x5de65a,0x1,_0x2b0d9b),'textureMaterialPos':Texture2D[_0xddd646(0xdb)](_0x5de65a,0x1,_0x2b0d9b*_0x33cd53)};return _0x358db3;}function resetMeshObjectView(_0x5ac052){const _0x5cd4d7=a88_0x496b;resetObjectView(_0x5ac052[_0x5cd4d7(0xc1)]),resetObjectView(_0x5ac052[_0x5cd4d7(0xf4)]);}function populateMeshObjectView(_0x65e9e8,_0x1644e4){const _0x4dc03f=a88_0x496b,_0x2f142a=_0x65e9e8[_0x4dc03f(0xdc)][_0x1644e4];if(_0x2f142a>=0.001){let _0x185adf=![],_0x2fa35e=![];if(_0x2f142a<0x1)_0x2fa35e=!![];else{const _0xbb76b4=_0x65e9e8[_0x4dc03f(0xe5)][_0x1644e4];_0x185adf=_0xbb76b4<=0x0,_0x2fa35e=_0xbb76b4>=0x0;}_0x185adf&&populateObjectView(_0x65e9e8['solidView'],_0x1644e4),_0x2fa35e&&populateObjectView(_0x65e9e8[_0x4dc03f(0xf4)],_0x1644e4);}}function uploadMeshObjectView(_0x4fa36a){const _0x37fe1c=a88_0x496b;uploadObjectView(_0x4fa36a[_0x37fe1c(0xc1)]),uploadObjectView(_0x4fa36a[_0x37fe1c(0xf4)]);}function makeObjectView(_0x154b4d,_0x28966e){const _0x5a3291=a88_0x496b;let _0x38c328={'uObjCount':0x0,'textureObjPos':Texture2D[_0x5a3291(0xdb)](_0x154b4d,0x1,_0x28966e)};return _0x38c328;}function resetObjectView(_0x5671f7){const _0x13d3a0=a88_0x496b;_0x5671f7[_0x13d3a0(0xc9)]=0x0;}function populateObjectView(_0x2be25c,_0x3db57a){const _0x34ab59=a88_0x496b;let _0x496316=Texture2D[_0x34ab59(0xf1)](_0x2be25c['textureObjPos']);{_0x496316[_0x2be25c[_0x34ab59(0xc9)]]=_0x3db57a;}_0x2be25c['uObjCount']++;}function uploadObjectView(_0x1e89d2){const _0x5cea40=a88_0x496b;Texture2D[_0x5cea40(0xc2)](_0x1e89d2['textureObjPos']);}function updateObjSubsetView(_0x1cfe37,_0x43b8d1){const _0x95029b=a88_0x496b;let _0x1aa61b=Texture2D['getArrayData'](_0x1cfe37[_0x95029b(0xea)][_0x95029b(0xf6)]),_0x9d08f5=_0x1cfe37[_0x95029b(0xca)][_0x95029b(0xfa)]['_arrSubset'][_0x95029b(0xd1)];for(let _0x264c5d=0x0;_0x264c5d<_0x1cfe37['cleObjectArray'][_0x95029b(0xd1)];++_0x264c5d){const _0x240512=_0x1cfe37[_0x95029b(0xbd)][_0x264c5d];let _0x4885bf=0x0;for(let _0x4c460c=0x0;_0x4c460c<_0x9d08f5;++_0x4c460c){if(_0x4c460c<_0x240512[_0x95029b(0xe2)]['length']){const _0x3b4ed3=_0x240512['_arrSubsetMtlID'][_0x4c460c],_0x182d18=_0x43b8d1[_0x3b4ed3];_0x4885bf=_0x182d18[_0x95029b(0xf8)];}_0x1aa61b[_0x264c5d*_0x9d08f5+_0x4c460c]=_0x4885bf;}}Texture2D['uploadArrayData'](_0x1cfe37[_0x95029b(0xea)][_0x95029b(0xf6)]);}