'use strict';const a81_0x30b8=['1232669nlhDIr','_arrKeyFrameData','_uStartIndex','_arrSubsetMtlID','xyz<n','3247EldrBd','700679XUKTZO','textureWorld','textureAlpha','fromCleBox','1768568ddGtkc','vWorldMatrixArray','push','fromCleMatrix','uWorldAlphaRevision','transparentView','_arrIndexData','_stuModelData','fill','cleObjAnimationArray','uObjCount','_matLocal','cleObjectArray','_arrTranspKeyFrm','bContainUV','textureMaterialPos','16106lsJKpK','cleModel','transform','mul','invalid\x20material\x20index\x20','_nFillMode','length','vFlagArray','textureObjPos','_arrSubset','uPos','iBuffer','vAlphaArray','_box','textureWorldIT','uIndex','_arrVertexData','getArrayData','87KPZyZr','createStaticIndexBuffer','view','uploadArrayData','576032SphgmH','vWorldITMatrixArray','createForFloatArray','vBuffer','1100087APsqSJ','alpha','toTextureFloatArray','merge','_uIsUV','vSubsetBuffer','_arrObjSaveData','_matWorld','23AMGZyC','make','inverseTranspose','solidView','createStaticVertexBuffer','LogicError','xyz<n<uv'];(function(_0x12f79c,_0x3957aa){const _0x34258e=a81_0xaf3b;while(!![]){try{const _0x4f2325=parseInt(_0x34258e(0xa9))+parseInt(_0x34258e(0xbc))+parseInt(_0x34258e(0x93))*parseInt(_0x34258e(0xa5))+parseInt(_0x34258e(0xc2))+-parseInt(_0x34258e(0xad))+parseInt(_0x34258e(0xb5))*-parseInt(_0x34258e(0xc1))+-parseInt(_0x34258e(0xc6));if(_0x4f2325===_0x3957aa)break;else _0x12f79c['push'](_0x12f79c['shift']());}catch(_0x30cefd){_0x12f79c['push'](_0x12f79c['shift']());}}}(a81_0x30b8,0xec262));import*as a81_0x11fd5c from'../Math/math.js';import*as a81_0xfdd6c6 from'../Math/matrix.js';import*as a81_0x7ae3fa from'../Math/box.js';import*as a81_0xc417d7 from'./P3DComm.js';export function from(_0x328534,_0x3fb9c9,_0xd87ad7,_0xd25d83,_0x34fef5){const _0x373466=a81_0xaf3b;let _0x4f6a28={'uIndex':_0x3fb9c9['_uModelID'],'cleModel':_0x3fb9c9,'bounds':a81_0xc417d7[_0x373466(0xc5)](null,_0x3fb9c9[_0x373466(0x8a)][_0x373466(0xa0)]),'bContainUV':![],'cleObjectArray':new Array(),'cleObjAnimationArray':new Array(),'vFlagArray':new Array(),'vWorldMatrixArray':null,'vWorldITMatrixArray':null,'vAlphaArray':null,'vBuffer':null,'vSubsetBuffer':null,'iBuffer':null,'view':null,'solidView':null,'transparentView':null,'uWorldAlphaRevision':0x0},_0xb0b0d9=_0x3fb9c9['_stuModelData'];_0x4f6a28[_0x373466(0x91)]=_0xb0b0d9[_0x373466(0xb1)]===0x1,_0x4f6a28[_0x373466(0xac)]=Buffer[_0x373466(0xb9)](_0x328534,_0xb0b0d9[_0x373466(0xa3)],_0x4f6a28['bContainUV']?_0x373466(0xbb):_0x373466(0xc0)),_0x4f6a28[_0x373466(0xb2)]=buildVertexSubsetIndex(_0x328534,_0x3fb9c9),_0x4f6a28[_0x373466(0x9e)]=Buffer[_0x373466(0xa6)](_0x328534,_0xb0b0d9['_arrIndexData']);const _0x31a960=_0x4f6a28[_0x373466(0xa2)];for(const _0x21c7e9 of _0xd87ad7[_0x373466(0xb3)]){if(_0x21c7e9[_0x373466(0x98)]!=ADFFILL_SOLID)continue;if(_0x21c7e9['_uMeshID']==_0x31a960){let _0x466f2b=computeSubsetFlag(_0x3fb9c9,_0x21c7e9,_0x34fef5);_0x4f6a28['cleObjectArray'][_0x373466(0x85)](_0x21c7e9),_0x4f6a28['cleObjAnimationArray'][_0x373466(0x85)](_0xd25d83[_0x21c7e9['_uObjectID']]),_0x4f6a28[_0x373466(0x9a)][_0x373466(0x85)](_0x466f2b);}}return _0x4f6a28[_0x373466(0xc7)]=new Array(_0x4f6a28[_0x373466(0x8f)][_0x373466(0x99)]),_0x4f6a28[_0x373466(0xaa)]=new Array(_0x4f6a28[_0x373466(0x8f)][_0x373466(0x99)]),_0x4f6a28['vAlphaArray']=new Array(_0x4f6a28[_0x373466(0x8f)][_0x373466(0x99)])[_0x373466(0x8b)](0x1),_0x4f6a28[_0x373466(0xa7)]=makeView(_0x328534,_0x4f6a28[_0x373466(0x8f)]['length'],_0x3fb9c9[_0x373466(0x8a)][_0x373466(0x9c)][_0x373466(0x99)]),_0x4f6a28[_0x373466(0xb8)]=makeObjectView(_0x328534,_0x4f6a28[_0x373466(0x8f)][_0x373466(0x99)]),_0x4f6a28[_0x373466(0x88)]=makeObjectView(_0x328534,_0x4f6a28[_0x373466(0x8f)][_0x373466(0x99)]),initWorldMatrixAndAlpha(_0x4f6a28),updateObjSubsetView(_0x4f6a28,_0x34fef5),_0x4f6a28;}function buildVertexSubsetIndex(_0x2db51d,_0x48ebcb){const _0x1177b0=a81_0xaf3b;let _0x1da50d=_0x48ebcb[_0x1177b0(0x8a)],_0x2dedbb=new Array(_0x1da50d[_0x1177b0(0xa3)][_0x1177b0(0x99)]/(_0x1da50d[_0x1177b0(0xb1)]===0x1?0x8:0x6));if(_0x48ebcb[_0x1177b0(0x8a)][_0x1177b0(0x9c)][_0x1177b0(0x99)]>0x1)for(let _0x5a33ee=0x0;_0x5a33ee<_0x48ebcb[_0x1177b0(0x8a)][_0x1177b0(0x9c)][_0x1177b0(0x99)];++_0x5a33ee){let _0x21e891=_0x48ebcb[_0x1177b0(0x8a)][_0x1177b0(0x9c)][_0x5a33ee][_0x1177b0(0xbe)],_0xe54d89=_0x48ebcb[_0x1177b0(0x8a)][_0x1177b0(0x9c)][_0x5a33ee]['_uIndexCount'];for(let _0x1522b6=0x0;_0x1522b6<_0xe54d89;++_0x1522b6){let _0x59b8bb=_0x21e891+_0x1522b6,_0x289634=_0x1da50d[_0x1177b0(0x89)][_0x59b8bb];_0x2dedbb[_0x289634]=_0x5a33ee;}}else _0x2dedbb[_0x1177b0(0x8b)](0x0);return Buffer[_0x1177b0(0xb9)](_0x2db51d,new Float32Array(_0x2dedbb),'i1');}function computeSubsetFlag(_0x4e87b4,_0x14e9e9,_0x252692){const _0x11f666=a81_0xaf3b;let _0x27ffb9=0x0;if(_0x4e87b4[_0x11f666(0x8a)][_0x11f666(0x9c)][_0x11f666(0x99)]>0x1&&_0x4e87b4['_stuModelData'][_0x11f666(0x9c)][_0x11f666(0x99)]==_0x14e9e9['_arrSubsetMtlID'][_0x11f666(0x99)]){let _0xc3249b=0x0,_0x196f22=0x0;for(let _0x20c044=0x0;_0x20c044<_0x14e9e9[_0x11f666(0xbf)][_0x11f666(0x99)];++_0x20c044){let _0x1194ff=_0x14e9e9[_0x11f666(0xbf)][_0x20c044],_0x524599=_0x252692[_0x1194ff];if(_0x524599==null)throw new error[(_0x11f666(0xba))]('invalid\x20material\x20index\x20'+_0x1194ff);_0x524599['alpha']<0x1?_0x196f22++:_0xc3249b++;}if(_0xc3249b==_0x14e9e9['_arrSubsetMtlID'][_0x11f666(0x99)])_0x27ffb9=-0x1;else _0x196f22==_0x14e9e9[_0x11f666(0xbf)]['length']&&(_0x27ffb9=0x1);}else{let _0x3e38a2=0x0;_0x14e9e9[_0x11f666(0xbf)][_0x11f666(0x99)]>0x0&&(_0x3e38a2=_0x14e9e9['_arrSubsetMtlID'][0x0]);let _0x4f0cfd=_0x252692[_0x3e38a2];if(_0x4f0cfd==null)throw new error['LogicError'](_0x11f666(0x97)+_0x3e38a2);_0x27ffb9=_0x4f0cfd[_0x11f666(0xae)]<0x1?0x1:-0x1;}return _0x27ffb9;}function a81_0xaf3b(_0x30deb4,_0x59f592){_0x30deb4=_0x30deb4-0x85;let _0x30b88c=a81_0x30b8[_0x30deb4];return _0x30b88c;}export function initWorldMatrixAndAlpha(_0xe400bb){const _0x3e369e=a81_0xaf3b;resetMeshObjectView(_0xe400bb);let _0x1942dd=new ADF_BASEMATRIX(),_0x18717f=Texture2D['getArrayData'](_0xe400bb['view'][_0x3e369e(0xc3)]),_0x2182c6=Texture2D[_0x3e369e(0xa4)](_0xe400bb[_0x3e369e(0xa7)][_0x3e369e(0xa1)]),_0x209bda=Texture2D[_0x3e369e(0xa4)](_0xe400bb[_0x3e369e(0xa7)][_0x3e369e(0xc4)]);for(let _0x42206d=0x0;_0x42206d<_0xe400bb['cleObjectArray'][_0x3e369e(0x99)];++_0x42206d){let _0xcb3cee=_0xe400bb['cleObjectArray'][_0x42206d],_0x270647=_0xe400bb[_0x3e369e(0x8c)][_0x42206d];if(_0x270647!=null&&_0x270647[_0x3e369e(0xbd)][_0x3e369e(0x99)]>0x0)CalculateObjectWldMatrix(0x0,_0x270647,_0xcb3cee[_0x3e369e(0x8e)],_0xcb3cee[_0x3e369e(0xb4)],_0x1942dd),_0xe400bb[_0x3e369e(0xc7)][_0x42206d]=a81_0xc417d7[_0x3e369e(0x86)](_0xe400bb[_0x3e369e(0xc7)][_0x42206d],_0x1942dd),_0xe400bb[_0x3e369e(0xaa)][_0x42206d]=a81_0xfdd6c6[_0x3e369e(0xb7)](_0xe400bb[_0x3e369e(0xaa)][_0x42206d],_0xe400bb[_0x3e369e(0xc7)][_0x42206d]);else{let _0x3dcf3e=a81_0xc417d7[_0x3e369e(0x86)](null,_0xcb3cee[_0x3e369e(0x8e)]),_0x27a411=a81_0xc417d7[_0x3e369e(0x86)](null,_0xcb3cee[_0x3e369e(0xb4)]);_0xe400bb[_0x3e369e(0xc7)][_0x42206d]=a81_0xfdd6c6[_0x3e369e(0x96)](_0xe400bb[_0x3e369e(0xc7)][_0x42206d],_0x3dcf3e,_0x27a411),_0xe400bb[_0x3e369e(0xaa)][_0x42206d]=a81_0xfdd6c6[_0x3e369e(0xb7)](_0xe400bb[_0x3e369e(0xaa)][_0x42206d],_0xe400bb[_0x3e369e(0xc7)][_0x42206d]);}_0x270647!=null&&_0x270647['_arrTranspKeyFrm'][_0x3e369e(0x99)]>0x0&&(_0xe400bb[_0x3e369e(0x9f)][_0x42206d]=CalculateObjectNoTransparency(0x0,_0x270647)),a81_0xfdd6c6[_0x3e369e(0xaf)](_0xe400bb[_0x3e369e(0xc7)][_0x42206d],_0x18717f,_0x42206d*0xc),a81_0xfdd6c6['toTextureFloatArray'](_0xe400bb[_0x3e369e(0xaa)][_0x42206d],_0x2182c6,_0x42206d*0xc),_0x209bda[_0x42206d]=_0xe400bb[_0x3e369e(0x9f)][_0x42206d],populateMeshObjectView(_0xe400bb,_0x42206d);}Texture2D[_0x3e369e(0xa8)](_0xe400bb[_0x3e369e(0xa7)][_0x3e369e(0xc3)]),Texture2D[_0x3e369e(0xa8)](_0xe400bb[_0x3e369e(0xa7)][_0x3e369e(0xa1)]),Texture2D['uploadArrayData'](_0xe400bb[_0x3e369e(0xa7)][_0x3e369e(0xc4)]),uploadMeshObjectView(_0xe400bb);}export function updateWorldMatrixAndAlpha(_0x54a3e8,_0x3dfd4f,_0x233fa6){const _0x54e207=a81_0xaf3b;if(_0x54a3e8[_0x54e207(0x87)]!=_0x233fa6){resetMeshObjectView(_0x54a3e8);let _0x43f6be=new ADF_BASEMATRIX(),_0x50d521=Texture2D['getArrayData'](_0x54a3e8['view'][_0x54e207(0xc3)]),_0xfc3f6c=Texture2D[_0x54e207(0xa4)](_0x54a3e8['view'][_0x54e207(0xa1)]),_0x16267f=Texture2D[_0x54e207(0xa4)](_0x54a3e8['view'][_0x54e207(0xc4)]),_0x3b821f=![],_0x4b0c05=![];for(let _0x17ab09=0x0;_0x17ab09<_0x54a3e8['cleObjectArray'][_0x54e207(0x99)];++_0x17ab09){let _0x3f1978=_0x54a3e8['cleObjectArray'][_0x17ab09],_0x1901a0=_0x54a3e8[_0x54e207(0x8c)][_0x17ab09];_0x1901a0!=null&&(_0x1901a0[_0x54e207(0xbd)][_0x54e207(0x99)]>0x0&&(CalculateObjectWldMatrix(_0x3dfd4f,_0x1901a0,_0x3f1978[_0x54e207(0x8e)],_0x3f1978[_0x54e207(0xb4)],_0x43f6be),_0x54a3e8[_0x54e207(0xc7)][_0x17ab09]=a81_0xc417d7[_0x54e207(0x86)](_0x54a3e8[_0x54e207(0xc7)][_0x17ab09],_0x43f6be),_0x54a3e8[_0x54e207(0xaa)][_0x17ab09]=a81_0xfdd6c6['inverseTranspose'](_0x54a3e8[_0x54e207(0xaa)][_0x17ab09],_0x54a3e8[_0x54e207(0xc7)][_0x17ab09]),a81_0xfdd6c6[_0x54e207(0xaf)](_0x54a3e8[_0x54e207(0xc7)][_0x17ab09],_0x50d521,_0x17ab09*0xc),a81_0xfdd6c6[_0x54e207(0xaf)](_0x54a3e8['vWorldITMatrixArray'][_0x17ab09],_0xfc3f6c,_0x17ab09*0xc),_0x3b821f=!![]),_0x1901a0[_0x54e207(0x90)][_0x54e207(0x99)]>0x0&&(_0x54a3e8[_0x54e207(0x9f)][_0x17ab09]=CalculateObjectNoTransparency(_0x3dfd4f,_0x1901a0),_0x16267f[_0x17ab09]=_0x54a3e8[_0x54e207(0x9f)][_0x17ab09],_0x4b0c05=!![])),populateMeshObjectView(_0x54a3e8,_0x17ab09);}_0x3b821f&&(Texture2D['uploadArrayData'](_0x54a3e8[_0x54e207(0xa7)][_0x54e207(0xc3)]),Texture2D[_0x54e207(0xa8)](_0x54a3e8[_0x54e207(0xa7)][_0x54e207(0xa1)])),_0x4b0c05&&(Texture2D[_0x54e207(0xa8)](_0x54a3e8[_0x54e207(0xa7)][_0x54e207(0xc4)]),uploadMeshObjectView(_0x54a3e8)),_0x54a3e8[_0x54e207(0x87)]=_0x233fa6;}}export function updateBounds(_0x474d55,_0x35eef0){const _0x56b828=a81_0xaf3b;let _0x23687d=a81_0x7ae3fa[_0x56b828(0xb6)]();for(const _0x5e158d of _0x474d55[_0x56b828(0xc7)]){_0x23687d=a81_0x7ae3fa[_0x56b828(0x95)](_0x23687d,_0x474d55['bounds'],_0x5e158d),_0x35eef0=a81_0x7ae3fa[_0x56b828(0xb0)](_0x35eef0,_0x35eef0,_0x23687d);}}function makeView(_0x39b83c,_0x4a89fa,_0x2d1813){const _0x1b767=a81_0xaf3b;let _0x688e8a={'textureWorld':Texture2D[_0x1b767(0xab)](_0x39b83c,0x4,_0x4a89fa*0x3),'textureWorldIT':Texture2D[_0x1b767(0xab)](_0x39b83c,0x4,_0x4a89fa*0x3),'textureAlpha':Texture2D[_0x1b767(0xab)](_0x39b83c,0x1,_0x4a89fa),'textureMaterialPos':Texture2D[_0x1b767(0xab)](_0x39b83c,0x1,_0x4a89fa*_0x2d1813)};return _0x688e8a;}function resetMeshObjectView(_0x3b27b8){const _0x19ef93=a81_0xaf3b;resetObjectView(_0x3b27b8['solidView']),resetObjectView(_0x3b27b8[_0x19ef93(0x88)]);}function populateMeshObjectView(_0x119d66,_0x198ba4){const _0xd35803=a81_0xaf3b,_0x3d767f=_0x119d66[_0xd35803(0x9f)][_0x198ba4];if(_0x3d767f>=0.001){let _0x4aac52=![],_0x4dcda5=![];if(_0x3d767f<0x1)_0x4dcda5=!![];else{const _0x9b4f8=_0x119d66[_0xd35803(0x9a)][_0x198ba4];_0x4aac52=_0x9b4f8<=0x0,_0x4dcda5=_0x9b4f8>=0x0;}_0x4aac52&&populateObjectView(_0x119d66[_0xd35803(0xb8)],_0x198ba4),_0x4dcda5&&populateObjectView(_0x119d66[_0xd35803(0x88)],_0x198ba4);}}function uploadMeshObjectView(_0x5f2402){const _0x5eb28d=a81_0xaf3b;uploadObjectView(_0x5f2402['solidView']),uploadObjectView(_0x5f2402[_0x5eb28d(0x88)]);}function makeObjectView(_0xaaaa8d,_0x5c352b){let _0x1792cf={'uObjCount':0x0,'textureObjPos':Texture2D['createForFloatArray'](_0xaaaa8d,0x1,_0x5c352b)};return _0x1792cf;}function resetObjectView(_0x2d4d15){const _0x107699=a81_0xaf3b;_0x2d4d15[_0x107699(0x8d)]=0x0;}function populateObjectView(_0x2906ce,_0x5a7fb0){const _0x1c3e52=a81_0xaf3b;let _0x2175f4=Texture2D[_0x1c3e52(0xa4)](_0x2906ce[_0x1c3e52(0x9b)]);{_0x2175f4[_0x2906ce['uObjCount']]=_0x5a7fb0;}_0x2906ce['uObjCount']++;}function uploadObjectView(_0x5c3c45){const _0x46494e=a81_0xaf3b;Texture2D[_0x46494e(0xa8)](_0x5c3c45[_0x46494e(0x9b)]);}function updateObjSubsetView(_0x3ccd24,_0x178026){const _0x382b79=a81_0xaf3b;let _0x17780f=Texture2D[_0x382b79(0xa4)](_0x3ccd24[_0x382b79(0xa7)][_0x382b79(0x92)]),_0x10b99a=_0x3ccd24[_0x382b79(0x94)][_0x382b79(0x8a)][_0x382b79(0x9c)][_0x382b79(0x99)];for(let _0x4a4d88=0x0;_0x4a4d88<_0x3ccd24[_0x382b79(0x8f)][_0x382b79(0x99)];++_0x4a4d88){const _0x859dad=_0x3ccd24[_0x382b79(0x8f)][_0x4a4d88];let _0x457039=0x0;for(let _0x13f51d=0x0;_0x13f51d<_0x10b99a;++_0x13f51d){if(_0x13f51d<_0x859dad[_0x382b79(0xbf)][_0x382b79(0x99)]){const _0xb0c11e=_0x859dad[_0x382b79(0xbf)][_0x13f51d],_0x13bfbf=_0x178026[_0xb0c11e];_0x457039=_0x13bfbf[_0x382b79(0x9d)];}_0x17780f[_0x4a4d88*_0x10b99a+_0x13f51d]=_0x457039;}}Texture2D[_0x382b79(0xa8)](_0x3ccd24[_0x382b79(0xa7)]['textureMaterialPos']);}